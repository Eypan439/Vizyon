<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Vizyon Kitap ve Film KulÃ¼bÃ¼ ðŸ“–ðŸŽ¬</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>body{font-family:'Poppins',sans-serif;background-color:#f8f5ff;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.movie-card,.book-card{transition:transform 0.3s ease,box-shadow 0.3s ease}.movie-card:hover,.book-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,0.1)}.tab-active{border-bottom:3px solid #6d28d9;color:#6d28d9;font-weight:600}.rating-star{cursor:pointer;transition:transform 0.2s}.rating-star:hover{transform:scale(1.2)}.book-image{transition:transform 0.5s ease;height:280px;object-fit:cover}.book-image:hover{transform:scale(1.05)}.gradient-bg{background:linear-gradient(135deg,#6d28d9 0%,#8b5cf6 100%)}.film-details,.book-details{max-height:0;overflow:hidden;transition:max-height 0.5s ease}.film-details.active,.book-details.active{max-height:2000px}.loader{border-top-color:#6d28d9;-webkit-animation:spinner 1.5s linear infinite;animation:spinner 1.5s linear infinite}@-webkit-keyframes spinner{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.update-btn{transition:all 0.3s ease}.update-btn:hover{transform:translateY(-2px)}.verified-badge{width:20px;height:20px;margin-left:4px;display:inline-block;vertical-align:middle}.featured-comment{border-left:4px solid #8b5cf6;background-color:#f3f0ff}.modal{transition:opacity 0.25s ease}.modal-active{overflow-x:hidden;overflow-y:visible!important}.rating-input label{cursor:pointer}.rating-input input{display:none}.rating-input label svg{width:25px;height:25px;transition:all 0.2s ease}.rating-input label svg.filled{fill:#fbbf24}.rating-input label svg.empty{fill:none}.welcome-screen{background:linear-gradient(135deg,#6d28d9 0%,#8b5cf6 100%);min-height:100vh}.welcome-card{background-color:rgba(255,255,255,0.95);border-radius:1rem;box-shadow:0 10px 25px rgba(0,0,0,0.2);max-width:500px;width:90%}.welcome-card img{max-width:150px}.welcome-btn{transition:all 0.3s ease}.welcome-btn:hover{transform:translateY(-3px)}.book-card{height:100%;display:flex;flex-direction:column}.book-card-content{flex-grow:1;display:flex;flex-direction:column}.book-actions{margin-top:auto}.pdf-download-btn{transition:all 0.3s ease}.pdf-download-btn:hover{transform:translateY(-2px)}.user-row{cursor:pointer;transition:background-color 0.2s ease}.user-row:hover{background-color:#f3f0ff}.user-profile-modal{max-height:80vh}.user-profile-content{max-height:calc(80vh - 120px);overflow-y:auto}.profile-tabs{border-bottom:1px solid #e5e7eb}.profile-tab{position:relative;cursor:pointer}.profile-tab.active{color:#6d28d9;font-weight:600}.profile-tab.active:after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background-color:#6d28d9}.profile-content{display:none}.profile-content.active{display:block}.watched-item{transition:all 0.2s ease}.watched-item:hover{transform:translateY(-2px);box-shadow:0 4px 6px rgba(0,0,0,0.1)}.admin-profile-tabs{border-bottom:1px solid #e5e7eb}.admin-profile-tab{position:relative;cursor:pointer}.admin-profile-tab.active{color:#6d28d9;font-weight:600}.admin-profile-tab.active:after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;background-color:#6d28d9}.admin-profile-content{display:none}.admin-profile-content.active{display:block}</style></head><body><div id="welcome-screen" class="welcome-screen flex items-center justify-center"><div class="welcome-card p-8 flex flex-col items-center"><div class="mb-6"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h18M3 16h18"/></svg></div><h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Vizyon Kitap ve Film KulÃ¼bÃ¼</h1><p class="text-gray-600 text-center mb-8">Kitap ve film tutkunlarÄ± iÃ§in Ã¶zel bir platform</p><div class="flex flex-col w-full space-y-4"><button id="welcome-login-btn" class="welcome-btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md">GiriÅŸ Yap</button><button id="welcome-register-btn" class="welcome-btn bg-white hover:bg-gray-100 text-purple-600 font-bold py-3 px-6 rounded-lg border border-purple-600 shadow-md">KayÄ±t Ol</button><button id="welcome-guest-btn" class="text-gray-500 hover:text-gray-700 font-medium py-2">Misafir olarak devam et</button></div></div></div><div id="main-app" class="min-h-screen flex flex-col hidden"><header class="gradient-bg text-white shadow-lg"><div class="container mx-auto px-4 py-6"><div class="flex flex-col md:flex-row justify-between items-center"><div class="flex items-center mb-4 md:mb-0"><div class="text-3xl font-bold flex items-center"><span>Vizyon Kitap ve Film KulÃ¼bÃ¼</span><span class="ml-2 text-2xl">ðŸ“–ðŸŽ¬</span></div></div><div class="flex items-center space-x-4"><div class="flex space-x-4"><button id="btn-films" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">Filmler</button><button id="btn-books" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">Kitaplar</button><button id="btn-music" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">MÃ¼zik</button></div><div id="user-logged-out" class="flex space-x-2"><button id="btn-login" class="px-4 py-2 rounded-lg bg-purple-600 text-white font-medium hover:bg-purple-700 transition">GiriÅŸ Yap</button><button id="btn-register" class="px-4 py-2 rounded-lg bg-white text-purple-700 border border-purple-700 font-medium hover:bg-purple-50 transition">KayÄ±t Ol</button></div><div id="user-logged-in" class="hidden relative"><button id="user-menu-button" class="flex items-center space-x-2 px-4 py-2 rounded-lg bg-purple-700 text-white font-medium hover:bg-purple-800 transition"><span id="user-name-display">KullanÄ±cÄ±</span><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button><div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10"><a href="#" id="btn-profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Profilim</a><a href="#" id="btn-admin-panel" class="hidden block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Admin Paneli</a><a href="#" id="btn-logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Ã‡Ä±kÄ±ÅŸ Yap</a></div></div></div></div></div></header><div id="loading" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden"><div class="bg-white p-5 rounded-lg flex flex-col items-center"><div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div><h2 class="text-center text-gray-800 text-xl font-semibold">YÃ¼kleniyor...</h2><p class="w-full text-center text-gray-600">Veriler getiriliyor, lÃ¼tfen bekleyin.</p></div></div><main class="flex-grow container mx-auto px-4 py-8"><section id="films-section" class="mb-12"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">Film KulÃ¼bÃ¼</h2><div class="flex space-x-2"><button id="add-film-btn" class="admin-only hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>Film Ekle</button></div></div><div class="mb-6 border-b border-gray-200"><div class="flex overflow-x-auto" id="film-tabs"><button class="film-tab tab-active px-6 py-3 text-gray-700 whitespace-nowrap" data-tab="all">TÃ¼m Filmler</button></div></div><div class="space-y-8" id="film-cards"></div></section><section id="books-section" class="mb-12 hidden"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">Kitap KulÃ¼bÃ¼</h2><button id="add-book-btn" class="admin-only hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>Kitap Ekle</button></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="book-cards"></div></section><section id="music-section" class="mb-12 hidden"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">MÃ¼zik KÃ¶ÅŸesi</h2></div><div class="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl shadow-lg overflow-hidden text-white"><div class="p-8"><h3 class="text-2xl font-bold mb-4">Vizyon Playlist</h3><p class="mb-6">Vizyon rengarenk insanlardan oluÅŸan bir topluluk ve neden bu rengarenk zevklerden oluÅŸan bir playlistimiz olmasÄ±n? Sen de bir renk katmayÄ± unutma!</p><a href="https://open.spotify.com/playlist/1tGeLgECLa3lDx3X1DYzlN?si=5kI9UGfaRLu7GE0lcPcM9Q" target="_blank" class="inline-flex items-center px-6 py-3 bg-white text-purple-700 rounded-lg font-medium hover:bg-gray-100 transition"><svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>Spotify Playlist'e Git</a></div></div></section><section id="profile-section" class="mb-12 hidden"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">Profilim</h2></div><div class="bg-white rounded-xl shadow-md overflow-hidden"><div class="md:flex"><div class="md:flex-shrink-0"><div class="h-64 w-full md:w-48 bg-purple-100 flex items-center justify-center overflow-hidden"><img id="profile-image" class="h-full w-full object-cover" src="" alt="Profil Resmi"></div></div><div class="p-8"><div class="uppercase tracking-wide text-sm text-purple-600 font-semibold">KullanÄ±cÄ± Bilgileri</div><h3 id="profile-name" class="mt-1 text-xl font-semibold text-gray-900"></h3><p id="profile-email" class="mt-2 text-gray-600"></p><p id="profile-gender" class="mt-2 text-gray-600"></p><p id="profile-age" class="mt-2 text-gray-600"></p><p id="profile-date" class="mt-2 text-gray-600"></p></div></div></div><div class="mt-8"><div class="profile-tabs flex border-b mb-6"><div class="profile-tab active px-4 py-2 mr-4" data-tab="comments">YorumlarÄ±m</div><div class="profile-tab px-4 py-2 mr-4" data-tab="watched">Ä°zlediklerim</div><div class="profile-tab px-4 py-2" data-tab="read">OkuduklarÄ±m</div></div><div id="profile-comments" class="profile-content active space-y-4"></div><div id="profile-watched" class="profile-content space-y-4 hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="watched-films"></div></div><div id="profile-read" class="profile-content space-y-4 hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="read-books"></div></div></div></section><section id="admin-section" class="mb-12 hidden"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">Admin Paneli</h2></div><div class="bg-white rounded-xl shadow-md overflow-hidden mb-8"><div class="p-6"><h3 class="text-xl font-semibold text-gray-800 mb-4">KullanÄ±cÄ±lar</h3><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ad Soyad</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cinsiyet</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">YaÅŸ</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ä°ÅŸlemler</th></tr></thead><tbody id="admin-users-table" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div><div class="bg-white rounded-xl shadow-md overflow-hidden"><div class="p-6"><h3 class="text-xl font-semibold text-gray-800 mb-4">TÃ¼m Yorumlar</h3><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">KullanÄ±cÄ±</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ä°Ã§erik</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Puan</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yorum</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mavi Tik</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ä°ÅŸlemler</th></tr></thead><tbody id="admin-comments-table" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div></section></main><footer class="bg-gray-800 text-white py-6"><div class="container mx-auto px-4"><div class="flex flex-col md:flex-row justify-between items-center"><div class="mb-4 md:mb-0"><p>Â© 2023 Vizyon Kitap ve Film KulÃ¼bÃ¼</p></div><div class="flex space-x-4"><a href="#" class="hover:text-purple-400 transition">HakkÄ±mÄ±zda</a><a href="#" class="hover:text-purple-400 transition">Ä°letiÅŸim</a></div></div></div></footer></div><div id="login-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold">GiriÅŸ Yap</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><form id="login-form"><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="login-email">Email</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="login-email" type="email" placeholder="Email" required></div><div class="mb-6"><label class="block text-gray-700 text-sm font-bold mb-2" for="login-password">Åžifre</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="login-password" type="password" placeholder="******************" required></div><div class="flex items-center justify-between"><button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">GiriÅŸ Yap</button><a class="inline-block align-baseline font-bold text-sm text-purple-600 hover:text-purple-800" href="#" id="forgot-password-link">Åžifremi Unuttum</a></div><div id="login-error" class="text-red-500 text-sm mt-4 hidden"></div></form></div></div></div><div id="register-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold">KayÄ±t Ol</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><form id="register-form"><div class="mb-4 flex space-x-4"><div class="w-1/2"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-firstname">Ad</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-firstname" type="text" placeholder="Ad" required></div><div class="w-1/2"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-lastname">Soyad</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-lastname" type="text" placeholder="Soyad" required></div></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-email">Email</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-email" type="email" placeholder="Email" required></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-password">Åžifre</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-password" type="password" placeholder="******************" required></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-age">YaÅŸ</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-age" type="number" min="13" max="120" placeholder="YaÅŸ" required></div><div class="mb-6"><label class="block text-gray-700 text-sm font-bold mb-2" for="register-gender">Cinsiyet</label><select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-gender" required><option value="">SeÃ§iniz</option><option value="Erkek">Erkek</option><option value="KadÄ±n">KadÄ±n</option></select></div><div class="flex items-center justify-between"><button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">KayÄ±t Ol</button></div><div id="register-error" class="text-red-500 text-sm mt-4 hidden"></div></form></div></div></div><div id="comment-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold" id="comment-modal-title">Yorum Ekle</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><form id="comment-form"><input type="hidden" id="comment-content-id" value=""><input type="hidden" id="comment-content-title" value=""><input type="hidden" id="comment-content-type" value=""><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2">Ä°zlediniz mi / Okudunuz mu?</label><div class="flex items-center"><input type="checkbox" id="comment-watched" class="mr-2"><label for="comment-watched">Evet</label></div></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2">PuanÄ±nÄ±z</label><div class="rating-input flex space-x-1"><input type="radio" name="rating" id="rating-1" value="1"><label for="rating-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-2" value="2"><label for="rating-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-3" value="3"><label for="rating-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-4" value="4"><label for="rating-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-5" value="5" checked><label for="rating-5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-6" value="6"><label for="rating-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-7" value="7"><label for="rating-7"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-8" value="8"><label for="rating-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-9" value="9"><label for="rating-9"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label><input type="radio" name="rating" id="rating-10" value="10"><label for="rating-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star empty"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></label></div></div><div class="mb-6"><label class="block text-gray-700 text-sm font-bold mb-2" for="comment-text">Yorumunuz</label><textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="comment-text" rows="4" placeholder="Yorumunuzu buraya yazÄ±n"></textarea></div><div class="flex items-center justify-between"><button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">GÃ¶nder</button></div><div id="comment-error" class="text-red-500 text-sm mt-4 hidden"></div></form></div></div></div><div id="add-film-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold">Film Ekle</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><form id="add-film-form"><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="film-name">Film AdÄ±</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="film-name" type="text" placeholder="Film AdÄ±" required></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="film-year">YayÄ±n YÄ±lÄ±</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="film-year" type="text" placeholder="YayÄ±n YÄ±lÄ±"></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="film-image">Resim URL</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="film-image" type="text" placeholder="Resim URL"></div><div class="mb-6"><label class="block text-gray-700 text-sm font-bold mb-2" for="film-date-range">Tarih AralÄ±ÄŸÄ±</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="film-date-range" type="text" placeholder="Ã–rn: 21â€“25 Temmuz"></div><div class="flex items-center justify-between"><button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">Ekle</button></div><div id="add-film-error" class="text-red-500 text-sm mt-4 hidden"></div></form></div></div></div><div id="add-book-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold">Kitap Ekle</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><form id="add-book-form"><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="book-name">Kitap AdÄ±</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="book-name" type="text" placeholder="Kitap AdÄ±" required></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="book-author">Yazar</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="book-author" type="text" placeholder="Yazar"></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="book-image">Resim URL</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="book-image" type="text" placeholder="Resim URL"></div><div class="mb-4"><label class="block text-gray-700 text-sm font-bold mb-2" for="book-pdf">PDF URL (Ä°steÄŸe baÄŸlÄ±)</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="book-pdf" type="text" placeholder="PDF URL"></div><div class="mb-6"><label class="block text-gray-700 text-sm font-bold mb-2" for="book-date-range">Tarih AralÄ±ÄŸÄ±</label><input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="book-date-range" type="text" placeholder="Ã–rn: Temmuzun son haftasÄ±"></div><div class="flex items-center justify-between"><button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">Ekle</button></div><div id="add-book-error" class="text-red-500 text-sm mt-4 hidden"></div></form></div></div></div><div id="user-profile-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50"><div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div><div class="modal-container bg-white w-11/12 md:max-w-3xl mx-auto rounded shadow-lg z-50 overflow-hidden user-profile-modal"><div class="modal-content py-4 text-left px-6"><div class="flex justify-between items-center pb-3"><p class="text-2xl font-bold" id="user-profile-modal-title">KullanÄ±cÄ± Profili</p><div class="modal-close cursor-pointer z-50"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div></div><div class="user-profile-content"><div class="bg-gray-50 p-4 rounded-lg mb-6"><div class="md:flex"><div class="md:flex-shrink-0"><div class="h-32 w-32 bg-purple-100 flex items-center justify-center overflow-hidden rounded-full"><img id="admin-profile-image" class="h-full w-full object-cover" src="" alt="Profil Resmi"></div></div><div class="md:ml-6 mt-4 md:mt-0"><div class="uppercase tracking-wide text-sm text-purple-600 font-semibold">KullanÄ±cÄ± Bilgileri</div><h3 id="admin-profile-name" class="mt-1 text-xl font-semibold text-gray-900"></h3><p id="admin-profile-email" class="mt-2 text-gray-600"></p><div class="flex flex-wrap mt-2"><p id="admin-profile-gender" class="text-gray-600 mr-6"></p><p id="admin-profile-age" class="text-gray-600 mr-6"></p><p id="admin-profile-role" class="text-gray-600"></p></div><p id="admin-profile-date" class="mt-2 text-gray-600"></p></div></div></div><div class="admin-profile-tabs flex border-b mb-6"><div class="admin-profile-tab active px-4 py-2 mr-4" data-tab="comments">Yorumlar</div><div class="admin-profile-tab px-4 py-2 mr-4" data-tab="watched">Ä°zledikleri</div><div class="admin-profile-tab px-4 py-2" data-tab="read">OkuduklarÄ±</div></div><div id="admin-user-comments" class="admin-profile-content active space-y-4"></div><div id="admin-user-watched" class="admin-profile-content hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="admin-watched-films"></div></div><div id="admin-user-read" class="admin-profile-content hidden"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="admin-read-books"></div></div></div></div></div></div><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script><script>const firebaseConfig={apiKey:"AIzaSyD3i3UYYvAiGiEpM14SXbVTd9U9jk1BO58",authDomain:"vizyon-da2dd.firebaseapp.com",projectId:"vizyon-da2dd",storageBucket:"vizyon-da2dd.firebasestorage.app",messagingSenderId:"801926636810",appId:"1:801926636810:web:f0789b9ef104c7338e86f3",measurementId:"G-M97R718RT1"};firebase.initializeApp(firebaseConfig);const auth=firebase.auth();const db=firebase.firestore();const welcomeScreen=document.getElementById('welcome-screen');const mainApp=document.getElementById('main-app');const loadingIndicator=document.getElementById('loading');const userLoggedOut=document.getElementById('user-logged-out');const userLoggedIn=document.getElementById('user-logged-in');const userNameDisplay=document.getElementById('user-name-display');const userDropdown=document.getElementById('user-dropdown');const btnAdminPanel=document.getElementById('btn-admin-panel');const adminElements=document.querySelectorAll('.admin-only');const btnFilms=document.getElementById('btn-films');const btnBooks=document.getElementById('btn-books');const btnMusic=document.getElementById('btn-music');const btnProfile=document.getElementById('btn-profile');const btnLogin=document.getElementById('btn-login');const btnRegister=document.getElementById('btn-register');const btnLogout=document.getElementById('btn-logout');const btnAddFilm=document.getElementById('add-film-btn');const btnAddBook=document.getElementById('add-book-btn');const welcomeLoginBtn=document.getElementById('welcome-login-btn');const welcomeRegisterBtn=document.getElementById('welcome-register-btn');const welcomeGuestBtn=document.getElementById('welcome-guest-btn');const filmsSection=document.getElementById('films-section');const booksSection=document.getElementById('books-section');const musicSection=document.getElementById('music-section');const profileSection=document.getElementById('profile-section');const adminSection=document.getElementById('admin-section');const filmTabsContainer=document.getElementById('film-tabs');const filmCardsContainer=document.getElementById('film-cards');const bookCardsContainer=document.getElementById('book-cards');const loginModal=document.getElementById('login-modal');const registerModal=document.getElementById('register-modal');const commentModal=document.getElementById('comment-modal');const addFilmModal=document.getElementById('add-film-modal');const addBookModal=document.getElementById('add-book-modal');const userProfileModal=document.getElementById('user-profile-modal');const loginForm=document.getElementById('login-form');const registerForm=document.getElementById('register-form');const commentForm=document.getElementById('comment-form');const addFilmForm=document.getElementById('add-film-form');const addBookForm=document.getElementById('add-book-form');let currentUser=null;let isAdmin=false;let dataLoaded=false;let contents=[];let comments=[];let users=[];

// VarsayÄ±lan profil resimleri - SVG formatÄ±nda
const defaultMaleImage = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%236d28d9"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>`;

const defaultFemaleImage = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d946ef"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>`;

const verifiedBadgeUrl="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Twitter_Verified_Badge.svg/2048px-Twitter_Verified_Badge.svg.png";document.addEventListener('DOMContentLoaded',()=>{setupEventListeners();auth.onAuthStateChanged(user=>{if(user){fetchUserData(user.uid);}else{currentUser=null;isAdmin=false;welcomeScreen.classList.remove('hidden');mainApp.classList.add('hidden');userLoggedIn.classList.add('hidden');userLoggedOut.classList.remove('hidden');userDropdown.classList.add('hidden');}});});function fetchUserData(userId){showLoading();db.collection('users').doc(userId).get().then(doc=>{if(doc.exists){const userData=doc.data();currentUser={id:userId,name:`${userData.ad} ${userData.soyad}`,email:userData.email,role:userData.role||'user',gender:userData.cinsiyet,age:userData.yas,createdAt:userData.createdAt};isAdmin=currentUser.role==='admin';showMainApp();}else{console.error("KullanÄ±cÄ± verisi bulunamadÄ±");auth.signOut();}hideLoading();}).catch(error=>{console.error("KullanÄ±cÄ± verisi getirme hatasÄ±:",error);hideLoading();});}function setupEventListeners(){welcomeLoginBtn.addEventListener('click',()=>{showModal('login-modal');});welcomeRegisterBtn.addEventListener('click',()=>{showModal('register-modal');});welcomeGuestBtn.addEventListener('click',()=>{loginAsGuest();});btnFilms.addEventListener('click',()=>{switchSection('films');});btnBooks.addEventListener('click',()=>{switchSection('books');});btnMusic.addEventListener('click',()=>{switchSection('music');});btnProfile.addEventListener('click',()=>{switchSection('profile');renderUserProfile();});btnAdminPanel.addEventListener('click',()=>{switchSection('admin');renderAdminPanel();});btnLogin.addEventListener('click',()=>{showModal('login-modal');});btnRegister.addEventListener('click',()=>{showModal('register-modal');});btnLogout.addEventListener('click',()=>{logout();});btnAddFilm.addEventListener('click',()=>{showModal('add-film-modal');});btnAddBook.addEventListener('click',()=>{showModal('add-book-modal');});document.getElementById('user-menu-button').addEventListener('click',()=>{userDropdown.classList.toggle('hidden');});document.querySelectorAll('.modal-close').forEach(button=>{button.addEventListener('click',()=>{const modal=button.closest('.modal');hideModal(modal.id);});});document.querySelectorAll('.modal-overlay').forEach(overlay=>{overlay.addEventListener('click',()=>{const modal=overlay.closest('.modal');hideModal(modal.id);});});loginForm.addEventListener('submit',(e)=>{e.preventDefault();const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;login(email,password);});registerForm.addEventListener('submit',(e)=>{e.preventDefault();const firstName=document.getElementById('register-firstname').value;const lastName=document.getElementById('register-lastname').value;const email=document.getElementById('register-email').value;const password=document.getElementById('register-password').value;const age=document.getElementById('register-age').value;const gender=document.getElementById('register-gender').value;register(firstName,lastName,email,password,age,gender);});commentForm.addEventListener('submit',(e)=>{e.preventDefault();const contentId=document.getElementById('comment-content-id').value;const contentTitle=document.getElementById('comment-content-title').value;const contentType=document.getElementById('comment-content-type').value;const rating=document.querySelector('input[name="rating"]:checked').value;const comment=document.getElementById('comment-text').value;const watched=document.getElementById('comment-watched').checked;addComment(contentId,contentTitle,contentType,rating,comment,watched);});addFilmForm.addEventListener('submit',(e)=>{e.preventDefault();const name=document.getElementById('film-name').value;const year=document.getElementById('film-year').value;const image=document.getElementById('film-image').value;const dateRange=document.getElementById('film-date-range').value;addFilm(name,year,image,dateRange);});addBookForm.addEventListener('submit',(e)=>{e.preventDefault();const name=document.getElementById('book-name').value;const author=document.getElementById('book-author').value;const image=document.getElementById('book-image').value;const pdfUrl=document.getElementById('book-pdf').value;const dateRange=document.getElementById('book-date-range').value;addBook(name,author,image,dateRange,pdfUrl);});filmTabsContainer.addEventListener('click',(e)=>{if(e.target.classList.contains('film-tab')){filterFilms(e.target);}});document.querySelectorAll('.rating-input label').forEach(label=>{label.addEventListener('click',()=>{const rating=label.getAttribute('for').split('-')[1];updateStarRating(rating);});});
// Profil sekmelerini ayarla
document.querySelectorAll('.profile-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const tabId = tab.dataset.tab;
    switchProfileTab(tabId);
  });
});

// Admin profil sekmelerini ayarla
document.querySelectorAll('.admin-profile-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const tabId = tab.dataset.tab;
    switchAdminProfileTab(tabId);
  });
});}function login(email,password){showLoading();auth.signInWithEmailAndPassword(email,password).then(()=>{hideModal('login-modal');}).catch(error=>{document.getElementById('login-error').textContent=error.message;document.getElementById('login-error').classList.remove('hidden');hideLoading();});}function register(firstName,lastName,email,password,age,gender){showLoading();auth.createUserWithEmailAndPassword(email,password).then(userCredential=>{const user=userCredential.user;return db.collection('users').doc(user.uid).set({ad:firstName,soyad:lastName,email:email,yas:parseInt(age),cinsiyet:gender,role:'user',createdAt:firebase.firestore.FieldValue.serverTimestamp()});}).then(()=>{hideModal('register-modal');}).catch(error=>{document.getElementById('register-error').textContent=error.message;document.getElementById('register-error').classList.remove('hidden');hideLoading();});}function loginAsGuest(){showLoading();auth.signInAnonymously().then(()=>{const user=auth.currentUser;return db.collection('users').doc(user.uid).set({ad:'Misafir',soyad:'KullanÄ±cÄ±',email:'misafir@example.com',role:'guest',isGuest:true,createdAt:firebase.firestore.FieldValue.serverTimestamp()});}).catch(error=>{console.error("Misafir giriÅŸi hatasÄ±:",error);hideLoading();});}function logout(){auth.signOut().catch(error=>{console.error("Ã‡Ä±kÄ±ÅŸ yapma hatasÄ±:",error);});}function showMainApp(){welcomeScreen.classList.add('hidden');mainApp.classList.remove('hidden');if(currentUser){userNameDisplay.textContent=currentUser.name;userLoggedOut.classList.add('hidden');userLoggedIn.classList.remove('hidden');if(isAdmin){btnAdminPanel.classList.remove('hidden');adminElements.forEach(el=>el.classList.remove('hidden'));}else{btnAdminPanel.classList.add('hidden');adminElements.forEach(el=>el.classList.add('hidden'));}}loadData();}function loadData(){showLoading();Promise.all([db.collection('icerikler').where('tur','==','film').get(),db.collection('icerikler').where('tur','==','kitap').get(),db.collection('yorumlar').get(),db.collection('users').get()]).then(([filmsSnapshot,booksSnapshot,commentsSnapshot,usersSnapshot])=>{contents=[];filmsSnapshot.forEach(doc=>{contents.push({id:doc.id,...doc.data()});});booksSnapshot.forEach(doc=>{contents.push({id:doc.id,...doc.data()});});comments=[];commentsSnapshot.forEach(doc=>{const data=doc.data();if(data.timestamp){data.timestamp=data.timestamp.toDate();}comments.push({id:doc.id,...data});});users=[];usersSnapshot.forEach(doc=>{const data=doc.data();if(data.createdAt){data.createdAt=data.createdAt.toDate();}users.push({id:doc.id,...data});});renderFilmTabs();renderFilms();renderBooks();dataLoaded=true;hideLoading();}).catch(error=>{console.error("Veri yÃ¼kleme hatasÄ±:",error);hideLoading();});}function renderFilmTabs(){const allFilmsTab=filmTabsContainer.querySelector('[data-tab="all"]');filmTabsContainer.innerHTML='';filmTabsContainer.appendChild(allFilmsTab);const films=contents.filter(content=>content.tur==="film");const uniqueFilmNames=[...new Set(films.map(film=>film.name))];uniqueFilmNames.forEach(filmName=>{const film=films.find(f=>f.name===filmName);if(film){const tab=document.createElement('button');tab.className='film-tab px-6 py-3 text-gray-700 whitespace-nowrap';tab.textContent=film.name;tab.dataset.tab=film.id;filmTabsContainer.appendChild(tab);}});}function renderFilms(filterId=null){filmCardsContainer.innerHTML='';let filmsToRender=contents.filter(content=>content.tur==="film");if(filterId){filmsToRender=filmsToRender.filter(film=>film.id===filterId);}if(filmsToRender.length===0){filmCardsContainer.innerHTML='<p class="text-gray-500 text-center py-8">HenÃ¼z film eklenmemiÅŸ.</p>';return;}filmsToRender.forEach(film=>{const filmComments=comments.filter(comment=>comment.icerikId===film.id);let avgRating=0;if(filmComments.length>0){avgRating=filmComments.reduce((sum,comment)=>sum+comment.puan,0)/filmComments.length;}const card=createContentCard(film,avgRating,filmComments,"film");filmCardsContainer.appendChild(card);});}function renderBooks(){bookCardsContainer.innerHTML='';const books=contents.filter(content=>content.tur==="kitap");if(books.length===0){bookCardsContainer.innerHTML='<p class="text-gray-500 text-center py-8">HenÃ¼z kitap eklenmemiÅŸ.</p>';return;}books.forEach(book=>{const bookComments=comments.filter(comment=>comment.icerikId===book.id);let avgRating=0;if(bookComments.length>0){avgRating=bookComments.reduce((sum,comment)=>sum+comment.puan,0)/bookComments.length;}const card=createBookCard(book,avgRating,bookComments);bookCardsContainer.appendChild(card);});}function createContentCard(content,avgRating,contentComments,type){const container=document.createElement('div');container.className='bg-white rounded-xl shadow-md overflow-hidden movie-card';const imageUrl=content.image&&content.image.trim()!==''?content.image:'https://via.placeholder.com/300x450?text=No+Image';const cardContent=`<div class="md:flex"><div class="md:flex-shrink-0"><div class="h-64 md:w-48 bg-purple-100 relative"><img src="${imageUrl}" alt="${content.name}" class="w-full h-full object-cover"><div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">${avgRating>0?avgRating.toFixed(1):'N/A'}</div></div></div><div class="p-6 flex flex-col justify-between"><div><h3 class="text-2xl font-semibold text-gray-800">${content.name}</h3><p class="text-gray-600 mt-1">${content.year||''}</p>${content.author?`<p class="text-purple-600 mt-1 font-medium">Yazar: ${content.author}</p>`:''} ${content.tarih_araligi?`<p class="text-purple-600 mt-1 font-medium">${content.tarih_araligi}</p>`:''}</div><div class="mt-6 flex justify-between items-center"><span class="text-sm text-gray-500 md:mr-8">${contentComments.length} yorum</span><div class="flex space-x-2">${currentUser?`<button class="add-comment-btn px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" data-id="${content.id}" data-title="${content.name}" data-type="${type}">Yorum Ekle</button>`:`<button class="px-4 py-2 bg-gray-400 text-white rounded-lg cursor-not-allowed">Yorum iÃ§in GiriÅŸ YapÄ±n</button>`}<button class="toggle-details px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-id="${content.id}">YorumlarÄ± GÃ¶ster</button></div></div></div></div><div class="film-details border-t border-gray-200 p-6" id="details-${content.id}"><div class="mb-6"><h4 class="text-lg font-semibold text-gray-700 mb-4">Yorumlar ve Puanlar</h4><div class="space-y-4" id="all-comments-${content.id}">${renderCommentsHTML(contentComments)}</div></div></div>`;container.innerHTML=cardContent;container.querySelector('.toggle-details').addEventListener('click',(e)=>{const contentId=e.target.dataset.id;toggleContentDetails(contentId);});const commentBtn=container.querySelector('.add-comment-btn');if(commentBtn){commentBtn.addEventListener('click',(e)=>{const contentId=e.target.dataset.id;const contentTitle=e.target.dataset.title;const contentType=e.target.dataset.type;showCommentModal(contentId,contentTitle,contentType);});}return container;}function createBookCard(book,avgRating,bookComments){const container=document.createElement('div');container.className='bg-white rounded-xl shadow-md overflow-hidden book-card';const imageUrl=book.image&&book.image.trim()!==''?book.image:'https://via.placeholder.com/300x450?text=No+Image';const hasPdf=book.pdfUrl&&book.pdfUrl.trim()!=='';const cardContent=`<div class="book-card-content"><div class="relative"><img src="${imageUrl}" alt="${book.name}" class="w-full book-image"><div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">${avgRating>0?avgRating.toFixed(1):'N/A'}</div></div><div class="p-6"><h3 class="text-xl font-semibold text-gray-800 mb-2">${book.name}</h3>${book.author?`<p class="text-purple-600 font-medium mb-2">Yazar: ${book.author}</p>`:''} ${book.tarih_araligi?`<p class="text-gray-600 mb-4">${book.tarih_araligi}</p>`:''}<div class="flex items-center justify-between mb-4"><span class="text-sm text-gray-500">${bookComments.length} yorum</span>${hasPdf?`<a href="${book.pdfUrl}" target="_blank" class="pdf-download-btn inline-flex items-center text-sm text-purple-600 hover:text-purple-800"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>PDF Ä°ndir</a>`:''}</div><div class="book-actions flex flex-col space-y-2">${currentUser?`<button class="add-comment-btn w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" data-id="${book.id}" data-title="${book.name}" data-type="kitap">Yorum Ekle</button>`:`<button class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg cursor-not-allowed">Yorum iÃ§in GiriÅŸ YapÄ±n</button>`}<button class="toggle-details w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-id="${book.id}">YorumlarÄ± GÃ¶ster</button></div></div></div><div class="book-details border-t border-gray-200 p-6" id="details-${book.id}"><div class="mb-6"><h4 class="text-lg font-semibold text-gray-700 mb-4">Yorumlar ve Puanlar</h4><div class="space-y-4" id="all-comments-${book.id}">${renderCommentsHTML(bookComments)}</div></div></div>`;container.innerHTML=cardContent;container.querySelector('.toggle-details').addEventListener('click',(e)=>{const contentId=e.target.dataset.id;toggleContentDetails(contentId);});const commentBtn=container.querySelector('.add-comment-btn');if(commentBtn){commentBtn.addEventListener('click',(e)=>{const contentId=e.target.dataset.id;const contentTitle=e.target.dataset.title;const contentType=e.target.dataset.type;showCommentModal(contentId,contentTitle,contentType);});}return container;}function renderCommentsHTML(contentComments){if(!contentComments||contentComments.length===0){return'<p class="text-gray-500">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.</p>';}
// YorumlarÄ± Ã¶nce verified durumuna gÃ¶re, sonra tarihe gÃ¶re sÄ±rala
const sortedComments=[...contentComments].sort((a,b)=>{
  // Ã–nce verified yorumlarÄ± en Ã¼ste getir
  if(a.verified && !b.verified) return -1;
  if(!a.verified && b.verified) return 1;
  // AynÄ± verified durumunda olanlarÄ± tarihe gÃ¶re sÄ±rala (en yeniden en eskiye)
  return new Date(b.timestamp) - new Date(a.timestamp);
});return sortedComments.map(comment=>{const isVerified=comment.verified===true;const commentClass=isVerified?'featured-comment rounded-lg p-4':'bg-gray-50 rounded-lg p-4';const verifiedBadge=isVerified?`<img src="${verifiedBadgeUrl}" alt="Verified" class="verified-badge ml-1">`:'';const formattedDate=comment.timestamp instanceof Date?comment.timestamp.toLocaleDateString('tr-TR'):new Date(comment.timestamp).toLocaleDateString('tr-TR');return`<div class="${commentClass}" data-comment-id="${comment.id}"><div class="flex justify-between items-start"><div><h5 class="font-semibold text-gray-800 flex items-center">${comment.userName||'Anonim'} ${verifiedBadge}</h5><span class="text-xs text-gray-500">${formattedDate}</span></div><div class="flex items-center"><svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg><span class="ml-1 text-gray-700">${comment.puan}/10</span></div></div><p class="mt-2 text-gray-600">${comment.yorum||''}</p></div>`;}).join('');}function toggleContentDetails(contentId){const detailsSection=document.getElementById(`details-${contentId}`);const toggleButton=document.querySelector(`.toggle-details[data-id="${contentId}"]`);if(detailsSection.classList.contains('active')){detailsSection.classList.remove('active');toggleButton.textContent='YorumlarÄ± GÃ¶ster';}else{detailsSection.classList.add('active');toggleButton.textContent='YorumlarÄ± Gizle';}}function renderUserProfile(){if(!currentUser)return;
// Profil resmi ayarla
let profileImage = currentUser.gender === "KadÄ±n" ? defaultFemaleImage : defaultMaleImage;
document.getElementById('profile-image').src = profileImage;

document.getElementById('profile-name').textContent=currentUser.name;
document.getElementById('profile-email').textContent=`Email: ${currentUser.email}`;
document.getElementById('profile-gender').textContent=`Cinsiyet: ${currentUser.gender||'BelirtilmemiÅŸ'}`;
document.getElementById('profile-age').textContent=`YaÅŸ: ${currentUser.age||'BelirtilmemiÅŸ'}`;
const createdDate=currentUser.createdAt instanceof Date?currentUser.createdAt.toLocaleDateString('tr-TR'):new Date().toLocaleDateString('tr-TR');
document.getElementById('profile-date').textContent=`KayÄ±t Tarihi: ${createdDate}`;

// Yorumlar sekmesini doldur
renderUserComments();
// Ä°zlenen filmler sekmesini doldur
renderWatchedFilms();
// Okunan kitaplar sekmesini doldur
renderReadBooks();}

function renderUserComments() {
  const userCommentsContainer = document.getElementById('profile-comments');
  userCommentsContainer.innerHTML = '';
  const userComments = comments.filter(comment => comment.userId === currentUser.id);
  
  if (userComments.length === 0) {
    userCommentsContainer.innerHTML = '<p class="text-gray-500">HenÃ¼z yorum yapmadÄ±nÄ±z.</p>';
  } else {
    // KullanÄ±cÄ± profilinde de yorumlarÄ± Ã¶nce verified sonra tarih sÄ±rasÄ±na gÃ¶re gÃ¶ster
    const sortedUserComments = [...userComments].sort((a, b) => {
      if (a.verified && !b.verified) return -1;
      if (!a.verified && b.verified) return 1;
      return new Date(b.timestamp) - new Date(a.timestamp);
    });
    
    sortedUserComments.forEach(comment => {
      const content = contents.find(c => c.id === comment.icerikId);
      const contentName = content ? content.name : 'Bilinmeyen Ä°Ã§erik';
      const contentType = comment.icerikTuru === 'film' ? 'Film' : 'Kitap';
      const formattedDate = comment.timestamp instanceof Date ? 
        comment.timestamp.toLocaleDateString('tr-TR') : 
        new Date(comment.timestamp).toLocaleDateString('tr-TR');
      
      const isVerified = comment.verified === true;
      const commentClass = isVerified ? 
        'bg-white rounded-lg shadow p-4 border-l-4 border-purple-500' : 
        'bg-white rounded-lg shadow p-4';
      
      const commentElement = document.createElement('div');
      commentElement.className = commentClass;
      commentElement.innerHTML = `
        <div class="flex justify-between items-start">
          <div>
            <h5 class="font-semibold text-gray-800">${contentName}</h5>
            <div class="flex items-center">
              <span class="text-xs text-purple-600">${contentType}</span>
              <span class="text-xs text-gray-500 ml-2">${formattedDate}</span>
              ${isVerified ? `<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>OnaylÄ±</span>` : ''}
            </div>
          </div>
          <div class="flex items-center">
            <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
            <span class="ml-1 text-gray-700">${comment.puan}/10</span>
          </div>
        </div>
        <p class="mt-2 text-gray-600">${comment.yorum || ''}</p>
      `;
      
      userCommentsContainer.appendChild(commentElement);
    });
  }
}

function renderWatchedFilms() {
  const watchedFilmsContainer = document.getElementById('watched-films');
  watchedFilmsContainer.innerHTML = '';
  
  // Ä°zlendi olarak iÅŸaretlenen film yorumlarÄ±nÄ± bul
  const watchedFilmComments = comments.filter(comment => 
    comment.userId === currentUser.id && 
    comment.icerikTuru === 'film' && 
    comment.izlendi === true
  );
  
  if (watchedFilmComments.length === 0) {
    watchedFilmsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center py-4">HenÃ¼z izlediÄŸiniz film bulunmuyor.</p>';
    return;
  }
  
  // Benzersiz film ID'lerini al (bir filmi birden fazla kez izlemiÅŸ olabilir)
  const uniqueFilmIds = [...new Set(watchedFilmComments.map(comment => comment.icerikId))];
  
  uniqueFilmIds.forEach(filmId => {
    const film = contents.find(content => content.id === filmId);
    if (!film) return;
    
    const filmComments = watchedFilmComments.filter(comment => comment.icerikId === filmId);
    const latestComment = filmComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
    
    const imageUrl = film.image && film.image.trim() !== '' ? 
      film.image : 'https://via.placeholder.com/300x450?text=No+Image';
    
    const formattedDate = latestComment.timestamp instanceof Date ? 
      latestComment.timestamp.toLocaleDateString('tr-TR') : 
      new Date(latestComment.timestamp).toLocaleDateString('tr-TR');
    
    const filmCard = document.createElement('div');
    filmCard.className = 'watched-item bg-white rounded-lg shadow overflow-hidden';
    filmCard.innerHTML = `
      <div class="relative h-48">
        <img src="${imageUrl}" alt="${film.name}" class="w-full h-full object-cover">
        <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
          ${latestComment.puan}/10
        </div>
      </div>
      <div class="p-4">
        <h3 class="font-semibold text-gray-800 mb-1">${film.name}</h3>
        <p class="text-xs text-gray-500">Ä°zleme tarihi: ${formattedDate}</p>
      </div>
    `;
    
    watchedFilmsContainer.appendChild(filmCard);
  });
}

function renderReadBooks() {
  const readBooksContainer = document.getElementById('read-books');
  readBooksContainer.innerHTML = '';
  
  // Okundu olarak iÅŸaretlenen kitap yorumlarÄ±nÄ± bul
  const readBookComments = comments.filter(comment => 
    comment.userId === currentUser.id && 
    comment.icerikTuru === 'kitap' && 
    comment.izlendi === true
  );
  
  if (readBookComments.length === 0) {
    readBooksContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center py-4">HenÃ¼z okuduÄŸunuz kitap bulunmuyor.</p>';
    return;
  }
  
  // Benzersiz kitap ID'lerini al
  const uniqueBookIds = [...new Set(readBookComments.map(comment => comment.icerikId))];
  
  uniqueBookIds.forEach(bookId => {
    const book = contents.find(content => content.id === bookId);
    if (!book) return;
    
    const bookComments = readBookComments.filter(comment => comment.icerikId === bookId);
    const latestComment = bookComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
    
    const imageUrl = book.image && book.image.trim() !== '' ? 
      book.image : 'https://via.placeholder.com/300x450?text=No+Image';
    
    const formattedDate = latestComment.timestamp instanceof Date ? 
      latestComment.timestamp.toLocaleDateString('tr-TR') : 
      new Date(latestComment.timestamp).toLocaleDateString('tr-TR');
    
    const bookCard = document.createElement('div');
    bookCard.className = 'watched-item bg-white rounded-lg shadow overflow-hidden';
    bookCard.innerHTML = `
      <div class="relative h-48">
        <img src="${imageUrl}" alt="${book.name}" class="w-full h-full object-cover">
        <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
          ${latestComment.puan}/10
        </div>
      </div>
      <div class="p-4">
        <h3 class="font-semibold text-gray-800 mb-1">${book.name}</h3>
        ${book.author ? `<p class="text-xs text-purple-600 mb-1">${book.author}</p>` : ''}
        <p class="text-xs text-gray-500">Okuma tarihi: ${formattedDate}</p>
      </div>
    `;
    
    readBooksContainer.appendChild(bookCard);
  });
}

function switchProfileTab(tabId) {
  // TÃ¼m sekmeleri pasif yap
  document.querySelectorAll('.profile-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // TÃ¼m iÃ§erikleri gizle
  document.querySelectorAll('.profile-content').forEach(content => {
    content.classList.remove('active');
    content.classList.add('hidden');
  });
  
  // SeÃ§ilen sekmeyi aktif yap
  document.querySelector(`.profile-tab[data-tab="${tabId}"]`).classList.add('active');
  
  // SeÃ§ilen iÃ§eriÄŸi gÃ¶ster
  const selectedContent = document.getElementById(`profile-${tabId}`);
  selectedContent.classList.add('active');
  selectedContent.classList.remove('hidden');
}

function switchAdminProfileTab(tabId) {
  // TÃ¼m sekmeleri pasif yap
  document.querySelectorAll('.admin-profile-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // TÃ¼m iÃ§erikleri gizle
  document.querySelectorAll('.admin-profile-content').forEach(content => {
    content.classList.remove('active');
    content.classList.add('hidden');
  });
  
  // SeÃ§ilen sekmeyi aktif yap
  document.querySelector(`.admin-profile-tab[data-tab="${tabId}"]`).classList.add('active');
  
  // SeÃ§ilen iÃ§eriÄŸi gÃ¶ster
  const selectedContent = document.getElementById(`admin-user-${tabId}`);
  selectedContent.classList.add('active');
  selectedContent.classList.remove('hidden');
}function renderAdminPanel(){if(!isAdmin)return;const adminUsersTable=document.getElementById('admin-users-table');adminUsersTable.innerHTML='';users.forEach(user=>{const row=document.createElement('tr');row.className='user-row';row.dataset.userId=user.id;const formattedDate=user.createdAt instanceof Date?user.createdAt.toLocaleDateString('tr-TR'):new Date().toLocaleDateString('tr-TR');row.innerHTML=`<td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${user.ad||''} ${user.soyad||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-500">${user.email||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-500">${user.cinsiyet||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-500">${user.yas||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.role==='admin'?'bg-green-100 text-green-800':'bg-gray-100 text-gray-800'}">${user.role||'user'}</span></td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><button class="text-purple-600 hover:text-purple-900 mr-2 view-profile-btn" data-user-id="${user.id}">Profili GÃ¶r</button><button class="text-indigo-600 hover:text-indigo-900 mr-2 make-admin-btn ${user.role==='admin'?'hidden':''}" data-user-id="${user.id}">Admin Yap</button><button class="text-red-600 hover:text-red-900 delete-user-btn" data-user-id="${user.id}">Sil</button></td>`;adminUsersTable.appendChild(row);});const adminCommentsTable=document.getElementById('admin-comments-table');adminCommentsTable.innerHTML='';
// Admin panelinde de yorumlarÄ± Ã¶nce verified sonra tarih sÄ±rasÄ±na gÃ¶re gÃ¶ster
const sortedAdminComments=[...comments].sort((a,b)=>{
  if(a.verified && !b.verified) return -1;
  if(!a.verified && b.verified) return 1;
  return new Date(b.timestamp) - new Date(a.timestamp);
});sortedAdminComments.forEach(comment=>{const row=document.createElement('tr');const content=contents.find(c=>c.id===comment.icerikId);const contentName=content?content.name:'Bilinmeyen Ä°Ã§erik';const formattedDate=comment.timestamp instanceof Date?comment.timestamp.toLocaleDateString('tr-TR'):new Date(comment.timestamp).toLocaleDateString('tr-TR');row.innerHTML=`<td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${comment.userName||'Anonim'}</div><div class="text-xs text-gray-500">${comment.userEmail||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${contentName}</div><div class="text-xs text-gray-500">${comment.icerikTuru==='film'?'Film':'Kitap'}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-900">${comment.puan}/10</div></td><td class="px-6 py-4"><div class="text-sm text-gray-900 max-w-xs truncate">${comment.yorum||''}</div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-500">${formattedDate}</div></td><td class="px-6 py-4 whitespace-nowrap"><input type="checkbox" class="toggle-verified-checkbox" data-comment-id="${comment.id}" ${comment.verified?'checked':''}></td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><button class="text-red-600 hover:text-red-900 delete-comment-btn" data-comment-id="${comment.id}">Sil</button></td>`;adminCommentsTable.appendChild(row);});document.querySelectorAll('.make-admin-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const userId=e.target.dataset.userId;makeUserAdmin(userId);});});document.querySelectorAll('.delete-user-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const userId=e.target.dataset.userId;deleteUser(userId);});});document.querySelectorAll('.view-profile-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const userId=e.target.dataset.userId;showUserProfile(userId);});});document.querySelectorAll('.user-row').forEach(row=>{row.addEventListener('click',()=>{const userId=row.dataset.userId;showUserProfile(userId);});});document.querySelectorAll('.toggle-verified-checkbox').forEach(checkbox=>{checkbox.addEventListener('change',(e)=>{const commentId=e.target.dataset.commentId;toggleCommentVerification(commentId,e.target.checked);});});document.querySelectorAll('.delete-comment-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{const commentId=e.target.dataset.commentId;deleteComment(commentId);});});}function showUserProfile(userId){if(!isAdmin)return;const user=users.find(u=>u.id===userId);if(!user)return;
// Profil resmi ayarla
let profileImage = user.cinsiyet === "KadÄ±n" ? defaultFemaleImage : defaultMaleImage;
document.getElementById('admin-profile-image').src = profileImage;

document.getElementById('user-profile-modal-title').textContent=`${user.ad} ${user.soyad} - Profil`;
document.getElementById('admin-profile-name').textContent=`${user.ad} ${user.soyad}`;
document.getElementById('admin-profile-email').textContent=`Email: ${user.email}`;
document.getElementById('admin-profile-gender').textContent=`Cinsiyet: ${user.cinsiyet||'BelirtilmemiÅŸ'}`;
document.getElementById('admin-profile-age').textContent=`YaÅŸ: ${user.yas||'BelirtilmemiÅŸ'}`;
document.getElementById('admin-profile-role').textContent=`Rol: ${user.role||'user'}`;
const createdDate=user.createdAt instanceof Date?user.createdAt.toLocaleDateString('tr-TR'):new Date().toLocaleDateString('tr-TR');
document.getElementById('admin-profile-date').textContent=`KayÄ±t Tarihi: ${createdDate}`;

// KullanÄ±cÄ±nÄ±n yorumlarÄ±nÄ± gÃ¶ster
renderAdminUserComments(userId);

// KullanÄ±cÄ±nÄ±n izlediÄŸi filmleri gÃ¶ster
renderAdminUserWatchedFilms(userId);

// KullanÄ±cÄ±nÄ±n okuduÄŸu kitaplarÄ± gÃ¶ster
renderAdminUserReadBooks(userId);

// Ä°lk sekmeyi aktif yap
switchAdminProfileTab('comments');

showModal('user-profile-modal');}

function renderAdminUserComments(userId) {
  const userCommentsContainer = document.getElementById('admin-user-comments');
  userCommentsContainer.innerHTML = '';
  
  const userComments = comments.filter(comment => comment.userId === userId);
  
  if (userComments.length === 0) {
    userCommentsContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Bu kullanÄ±cÄ± henÃ¼z yorum yapmamÄ±ÅŸ.</p>';
    return;
  }
  
  // YorumlarÄ± Ã¶nce verified sonra tarih sÄ±rasÄ±na gÃ¶re gÃ¶ster
  const sortedUserComments = [...userComments].sort((a, b) => {
    if (a.verified && !b.verified) return -1;
    if (!a.verified && b.verified) return 1;
    return new Date(b.timestamp) - new Date(a.timestamp);
  });
  
  sortedUserComments.forEach(comment => {
    const content = contents.find(c => c.id === comment.icerikId);
    const contentName = content ? content.name : 'Bilinmeyen Ä°Ã§erik';
    const contentType = comment.icerikTuru === 'film' ? 'Film' : 'Kitap';
    const formattedDate = comment.timestamp instanceof Date ? 
      comment.timestamp.toLocaleDateString('tr-TR') : 
      new Date(comment.timestamp).toLocaleDateString('tr-TR');
    
    const isVerified = comment.verified === true;
    const commentClass = isVerified ? 'border-l-4 border-purple-500 bg-purple-50' : '';
    
    const commentElement = document.createElement('div');
    commentElement.className = `bg-white rounded-lg shadow p-4 ${commentClass}`;
    commentElement.innerHTML = `
      <div class="flex justify-between items-start">
        <div>
          <h5 class="font-semibold text-gray-800">${contentName}</h5>
          <div class="flex items-center">
            <span class="text-xs text-purple-600">${contentType}</span>
            <span class="text-xs text-gray-500 ml-2">${formattedDate}</span>
            ${isVerified ? `
              <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                <svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                OnaylÄ±
              </span>
            ` : ''}
          </div>
        </div>
        <div class="flex items-center">
          <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
          </svg>
          <span class="ml-1 text-gray-700">${comment.puan}/10</span>
        </div>
      </div>
      <p class="mt-2 text-gray-600">${comment.yorum || ''}</p>
      <div class="mt-3 flex justify-end">
        <button class="admin-toggle-verified text-xs text-purple-600 hover:text-purple-800 mr-3" data-comment-id="${comment.id}" data-verified="${isVerified}">
          ${isVerified ? 'OnayÄ± KaldÄ±r' : 'Onayla'}
        </button>
        <button class="admin-delete-comment text-xs text-red-600 hover:text-red-800" data-comment-id="${comment.id}">Sil</button>
      </div>
    `;
    
    userCommentsContainer.appendChild(commentElement);
  });
  
  // Yorum onaylama ve silme butonlarÄ±na event listener ekle
  document.querySelectorAll('.admin-toggle-verified').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const commentId = e.target.dataset.commentId;
      const isVerified = e.target.dataset.verified === 'true';
      toggleCommentVerification(commentId, !isVerified);
      setTimeout(() => {
        showUserProfile(userId);
      }, 500);
    });
  });
  
  document.querySelectorAll('.admin-delete-comment').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const commentId = e.target.dataset.commentId;
      if (confirm("Bu yorumu silmek istediÄŸinize emin misiniz?")) {
        deleteComment(commentId);
        setTimeout(() => {
          showUserProfile(userId);
        }, 500);
      }
    });
  });
}

function renderAdminUserWatchedFilms(userId) {
  const watchedFilmsContainer = document.getElementById('admin-watched-films');
  watchedFilmsContainer.innerHTML = '';
  
  // Ä°zlendi olarak iÅŸaretlenen film yorumlarÄ±nÄ± bul
  const watchedFilmComments = comments.filter(comment => 
    comment.userId === userId && 
    comment.icerikTuru === 'film' && 
    comment.izlendi === true
  );
  
  if (watchedFilmComments.length === 0) {
    watchedFilmsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center py-4">Bu kullanÄ±cÄ± henÃ¼z film izlememiÅŸ.</p>';
    return;
  }
  
  // Benzersiz film ID'lerini al
  const uniqueFilmIds = [...new Set(watchedFilmComments.map(comment => comment.icerikId))];
  
  uniqueFilmIds.forEach(filmId => {
    const film = contents.find(content => content.id === filmId);
    if (!film) return;
    
    const filmComments = watchedFilmComments.filter(comment => comment.icerikId === filmId);
    const latestComment = filmComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
    
    const imageUrl = film.image && film.image.trim() !== '' ? 
      film.image : 'https://via.placeholder.com/300x450?text=No+Image';
    
    const formattedDate = latestComment.timestamp instanceof Date ? 
      latestComment.timestamp.toLocaleDateString('tr-TR') : 
      new Date(latestComment.timestamp).toLocaleDateString('tr-TR');
    
    const filmCard = document.createElement('div');
    filmCard.className = 'watched-item bg-white rounded-lg shadow overflow-hidden';
    filmCard.innerHTML = `
      <div class="relative h-48">
        <img src="${imageUrl}" alt="${film.name}" class="w-full h-full object-cover">
        <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
          ${latestComment.puan}/10
        </div>
      </div>
      <div class="p-4">
        <h3 class="font-semibold text-gray-800 mb-1">${film.name}</h3>
        <p class="text-xs text-gray-500">Ä°zleme tarihi: ${formattedDate}</p>
      </div>
    `;
    
    watchedFilmsContainer.appendChild(filmCard);
  });
}

function renderAdminUserReadBooks(userId) {
  const readBooksContainer = document.getElementById('admin-read-books');
  readBooksContainer.innerHTML = '';
  
  // Okundu olarak iÅŸaretlenen kitap yorumlarÄ±nÄ± bul
  const readBookComments = comments.filter(comment => 
    comment.userId === userId && 
    comment.icerikTuru === 'kitap' && 
    comment.izlendi === true
  );
  
  if (readBookComments.length === 0) {
    readBooksContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center py-4">Bu kullanÄ±cÄ± henÃ¼z kitap okumamÄ±ÅŸ.</p>';
    return;
  }
  
  // Benzersiz kitap ID'lerini al
  const uniqueBookIds = [...new Set(readBookComments.map(comment => comment.icerikId))];
  
  uniqueBookIds.forEach(bookId => {
    const book = contents.find(content => content.id === bookId);
    if (!book) return;
    
    const bookComments = readBookComments.filter(comment => comment.icerikId === bookId);
    const latestComment = bookComments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
    
    const imageUrl = book.image && book.image.trim() !== '' ? 
      book.image : 'https://via.placeholder.com/300x450?text=No+Image';
    
    const formattedDate = latestComment.timestamp instanceof Date ? 
      latestComment.timestamp.toLocaleDateString('tr-TR') : 
      new Date(latestComment.timestamp).toLocaleDateString('tr-TR');
    
    const bookCard = document.createElement('div');
    bookCard.className = 'watched-item bg-white rounded-lg shadow overflow-hidden';
    bookCard.innerHTML = `
      <div class="relative h-48">
        <img src="${imageUrl}" alt="${book.name}" class="w-full h-full object-cover">
        <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
          ${latestComment.puan}/10
        </div>
      </div>
      <div class="p-4">
        <h3 class="font-semibold text-gray-800 mb-1">${book.name}</h3>
        ${book.author ? `<p class="text-xs text-purple-600 mb-1">${book.author}</p>` : ''}
        <p class="text-xs text-gray-500">Okuma tarihi: ${formattedDate}</p>
      </div>
    `;
    
    readBooksContainer.appendChild(bookCard);
  });
}function makeUserAdmin(userId){if(!confirm("Bu kullanÄ±cÄ±yÄ± admin yapmak istediÄŸinize emin misiniz?")){return;}showLoading();db.collection('users').doc(userId).update({role:'admin'}).then(()=>{const userIndex=users.findIndex(u=>u.id===userId);if(userIndex!==-1){users[userIndex].role='admin';}renderAdminPanel();hideLoading();}).catch(error=>{console.error("Admin yapma hatasÄ±:",error);hideLoading();});}function deleteUser(userId){if(!confirm("Bu kullanÄ±cÄ±yÄ± silmek istediÄŸinize emin misiniz?")){return;}showLoading();db.collection('yorumlar').where('userId','==',userId).get().then(snapshot=>{const batch=db.batch();snapshot.forEach(doc=>{batch.delete(doc.ref);});return batch.commit();}).then(()=>{return db.collection('users').doc(userId).delete();}).then(()=>{users=users.filter(u=>u.id!==userId);comments=comments.filter(c=>c.userId!==userId);renderAdminPanel();hideLoading();}).catch(error=>{console.error("KullanÄ±cÄ± silme hatasÄ±:",error);hideLoading();});}function toggleCommentVerification(commentId,isVerified){showLoading();db.collection('yorumlar').doc(commentId).update({verified:isVerified}).then(()=>{const commentIndex=comments.findIndex(c=>c.id===commentId);if(commentIndex!==-1){comments[commentIndex].verified=isVerified;}renderAdminPanel();hideLoading();}).catch(error=>{console.error("Yorum doÄŸrulama hatasÄ±:",error);hideLoading();});}function deleteComment(commentId){if(!confirm("Bu yorumu silmek istediÄŸinize emin misiniz?")){return;}showLoading();db.collection('yorumlar').doc(commentId).delete().then(()=>{comments=comments.filter(c=>c.id!==commentId);renderAdminPanel();hideLoading();}).catch(error=>{console.error("Yorum silme hatasÄ±:",error);hideLoading();});}function showCommentModal(contentId,contentTitle,contentType){if(!currentUser)return;document.getElementById('comment-content-id').value=contentId;document.getElementById('comment-content-title').value=contentTitle;document.getElementById('comment-content-type').value=contentType;document.getElementById('comment-modal-title').textContent=`${contentTitle} iÃ§in Yorum Ekle`;document.getElementById('comment-watched').checked=false;document.getElementById('comment-text').value='';updateStarRating(5);showModal('comment-modal');}function updateStarRating(rating){document.querySelectorAll('.rating-input label svg').forEach(star=>{star.classList.remove('filled');star.classList.add('empty');});for(let i=1;i<=rating;i++){const star=document.querySelector(`label[for="rating-${i}"] svg`);if(star){star.classList.remove('empty');star.classList.add('filled');}}}function addComment(contentId,contentTitle,contentType,rating,comment,watched){if(!currentUser)return;showLoading();const commentData={icerikId:contentId,icerikAdi:contentTitle,icerikTuru:contentType,userId:currentUser.id,userName:currentUser.name,userEmail:currentUser.email,puan:parseInt(rating),yorum:comment,izlendi:watched,timestamp:firebase.firestore.FieldValue.serverTimestamp(),verified:false};db.collection('yorumlar').add(commentData).then(docRef=>{const newComment={id:docRef.id,...commentData,timestamp:new Date()};comments.push(newComment);hideModal('comment-modal');if(contentType==='film'){renderFilms();}else{renderBooks();}hideLoading();}).catch(error=>{document.getElementById('comment-error').textContent=error.message;document.getElementById('comment-error').classList.remove('hidden');hideLoading();});}function addFilm(name,year,image,dateRange){if(!isAdmin)return;showLoading();const filmData={name:name,year:year,image:image,tarih_araligi:dateRange,tur:'film',createdAt:firebase.firestore.FieldValue.serverTimestamp()};db.collection('icerikler').add(filmData).then(docRef=>{const newFilm={id:docRef.id,...filmData};contents.push(newFilm);hideModal('add-film-modal');renderFilmTabs();renderFilms();hideLoading();}).catch(error=>{document.getElementById('add-film-error').textContent=error.message;document.getElementById('add-film-error').classList.remove('hidden');hideLoading();});}function addBook(name,author,image,dateRange,pdfUrl){if(!isAdmin)return;showLoading();const bookData={name:name,author:author,image:image,tarih_araligi:dateRange,pdfUrl:pdfUrl,tur:'kitap',createdAt:firebase.firestore.FieldValue.serverTimestamp()};db.collection('icerikler').add(bookData).then(docRef=>{const newBook={id:docRef.id,...bookData};contents.push(newBook);hideModal('add-book-modal');renderBooks();hideLoading();}).catch(error=>{document.getElementById('add-book-error').textContent=error.message;document.getElementById('add-book-error').classList.remove('hidden');hideLoading();});}function filterFilms(tabElement){const tabId=tabElement.dataset.tab;document.querySelectorAll('.film-tab').forEach(tab=>tab.classList.remove('tab-active'));tabElement.classList.add('tab-active');if(tabId==='all'){renderFilms();}else{renderFilms(tabId);}}function switchSection(section){const sections={films:filmsSection,books:booksSection,music:musicSection,profile:profileSection,admin:adminSection};Object.values(sections).forEach(s=>s.classList.add('hidden'));sections[section].classList.remove('hidden');}function showModal(modalId){document.body.classList.add('modal-active');const modal=document.getElementById(modalId);modal.classList.remove('opacity-0');modal.classList.remove('pointer-events-none');}function hideModal(modalId){document.body.classList.remove('modal-active');const modal=document.getElementById(modalId);modal.classList.add('opacity-0');modal.classList.add('pointer-events-none');}function showLoading(){loadingIndicator.classList.remove('hidden');}function hideLoading(){loadingIndicator.classList.add('hidden');}</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9693e364d50cb657',t:'MTc1NDIwMzkwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>
