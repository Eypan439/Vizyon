

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vizyon Kitap ve Film KulÃ¼bÃ¼ ðŸ“–ðŸŽ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase v10 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, query, orderBy, where, doc, updateDoc, deleteDoc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD3i3UYYvAiGiEpM14SXbVTd9U9jk1BO58",
            authDomain: "vizyon-da2dd.firebaseapp.com",
            projectId: "vizyon-da2dd",
            storageBucket: "vizyon-da2dd.firebasestorage.app",
            messagingSenderId: "801926636810",
            appId: "1:801926636810:web:f0789b9ef104c7338e86f3",
            measurementId: "G-M97R718RT1"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.firebaseAuth = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile };
        window.firestore = { collection, getDocs, addDoc, query, orderBy, where, doc, updateDoc, deleteDoc, setDoc, getDoc };
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f5ff;
            overflow: hidden;
        }
        
        html {
            overflow: hidden;
        }
        
        ::-webkit-scrollbar {
            display: none;
        }
        
        html {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .main-content {
            height: 100vh;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .main-content::-webkit-scrollbar {
            display: none;
        }

        .movie-card, .book-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .movie-card:hover, .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .tab-active {
            border-bottom: 3px solid #6d28d9;
            color: #6d28d9;
            font-weight: 600;
        }

        .rating-star {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        .book-image {
            transition: transform 0.5s ease;
            height: 280px;
            object-fit: cover;
        }

        .book-image:hover {
            transform: scale(1.05);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #6d28d9 0%, #8b5cf6 100%);
        }

        .film-details, .book-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .film-details.active, .book-details.active {
            max-height: 2000px;
        }

        .loader {
            border-top-color: #6d28d9;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }

        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .update-btn {
            transition: all 0.3s ease;
        }

        .update-btn:hover {
            transform: translateY(-2px);
        }

        .verified-badge {
            width: 20px;
            height: 20px;
            margin-left: 4px;
            display: inline-block;
            vertical-align: middle;
        }

        .featured-comment {
            border-left: 4px solid #8b5cf6;
            background-color: #f3f0ff;
        }

        .modal {
            transition: opacity 0.25s ease;
        }

        .modal-active {
            overflow-x: hidden;
            overflow-y: visible !important;
        }

        .rating-input label {
            cursor: pointer;
        }

        .rating-input input {
            display: none;
        }

        .rating-input label svg {
            width: 25px;
            height: 25px;
            transition: all 0.2s ease;
        }

        .rating-input label svg.filled {
            fill: #fbbf24;
        }

        .rating-input label svg.empty {
            fill: none;
        }

        .welcome-screen {
            background: linear-gradient(135deg, #6d28d9 0%, #8b5cf6 100%);
            min-height: 100vh;
        }

        .welcome-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
        }

        .welcome-card img {
            max-width: 150px;
        }

        .welcome-btn {
            transition: all 0.3s ease;
        }

        .welcome-btn:hover {
            transform: translateY(-3px);
        }

        .book-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .book-card-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .book-actions {
            margin-top: auto;
        }

        .pdf-download-btn {
            transition: all 0.3s ease;
        }

        .pdf-download-btn:hover {
            transform: translateY(-2px);
        }

        .guest-notice {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="welcome-screen flex items-center justify-center">
        <div class="welcome-card p-8 flex flex-col items-center">
            <div class="mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h18M3 16h18"/>
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Vizyon Kitap ve Film KulÃ¼bÃ¼</h1>
            <p class="text-gray-600 text-center mb-8">Kitap ve film tutkunlarÄ± iÃ§in Ã¶zel bir platform</p>
            <div class="flex flex-col w-full space-y-4">
                <button id="welcome-login-btn" class="welcome-btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md">
                    GiriÅŸ Yap
                </button>
                <button id="welcome-register-btn" class="welcome-btn bg-white hover:bg-gray-100 text-purple-600 font-bold py-3 px-6 rounded-lg border border-purple-600 shadow-md">
                    KayÄ±t Ol
                </button>
                <button id="welcome-guest-btn" class="text-gray-500 hover:text-gray-700 font-medium py-2">
                    Misafir olarak devam et
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="main-content min-h-screen flex flex-col hidden">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="text-3xl font-bold flex items-center">
                            <span>Vizyon Kitap ve Film KulÃ¼bÃ¼</span>
                            <span class="ml-2 text-2xl">ðŸ“–ðŸŽ¬</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex space-x-4">
                            <button id="btn-films" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">
                                Filmler
                            </button>
                            <button id="btn-books" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">
                                Kitaplar
                            </button>
                            <button id="btn-music" class="px-4 py-2 rounded-lg bg-white text-purple-700 font-medium hover:bg-purple-100 transition">
                                MÃ¼zik
                            </button>
                        </div>
                        <div id="user-logged-out" class="flex space-x-2">
                            <button id="btn-login" class="px-4 py-2 rounded-lg bg-purple-600 text-white font-medium hover:bg-purple-700 transition">
                                GiriÅŸ Yap
                            </button>
                            <button id="btn-register" class="px-4 py-2 rounded-lg bg-white text-purple-700 border border-purple-700 font-medium hover:bg-purple-50 transition">
                                KayÄ±t Ol
                            </button>
                        </div>
                        <div id="user-logged-in" class="hidden relative">
                            <button id="user-menu-button" class="flex items-center space-x-2 px-4 py-2 rounded-lg bg-purple-700 text-white font-medium hover:bg-purple-800 transition">
                                <span id="user-name-display">KullanÄ±cÄ±</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                            <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10">
                                <a href="#" id="btn-profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Profilim</a>
                                <a href="#" id="btn-admin-panel" class="hidden block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Admin Paneli</a>
                                <a href="#" id="btn-logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-purple-100">Ã‡Ä±kÄ±ÅŸ Yap</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Loading Indicator -->
        <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white p-5 rounded-lg flex flex-col items-center">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                <h2 class="text-center text-gray-800 text-xl font-semibold">YÃ¼kleniyor...</h2>
                <p class="w-full text-center text-gray-600">Veriler getiriliyor, lÃ¼tfen bekleyin.</p>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <!-- Guest Notice -->
            <div id="guest-notice" class="guest-notice hidden">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Misafir olarak geziniyorsunuz. Yorum yapmak iÃ§in giriÅŸ yapmanÄ±z gerekiyor.</span>
                </div>
            </div>

            <!-- Films Section -->
            <section id="films-section" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Film KulÃ¼bÃ¼</h2>
                    <div class="flex space-x-2">
                        <button id="add-film-btn" class="admin-only hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Film Ekle
                        </button>
                    </div>
                </div>

                <!-- Film Tabs -->
                <div class="mb-6 border-b border-gray-200">
                    <div class="flex overflow-x-auto" id="film-tabs">
                        <button class="film-tab tab-active px-6 py-3 text-gray-700 whitespace-nowrap" data-tab="all">
                            TÃ¼m Filmler
                        </button>
                    </div>
                </div>

                <!-- Film Cards -->
                <div class="space-y-8" id="film-cards">
                    <!-- Film cards will be dynamically generated here -->
                </div>
            </section>

            <!-- Books Section -->
            <section id="books-section" class="mb-12 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Kitap KulÃ¼bÃ¼</h2>
                    <button id="add-book-btn" class="admin-only hidden px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Kitap Ekle
                    </button>
                </div>

                <!-- Book Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="book-cards">
                    <!-- Book cards will be dynamically generated here -->
                </div>
            </section>

            <!-- Music Section -->
            <section id="music-section" class="mb-12 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">MÃ¼zik KÃ¶ÅŸesi</h2>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl shadow-lg overflow-hidden text-white">
                    <div class="p-8">
                        <h3 class="text-2xl font-bold mb-4">Vizyon Playlist</h3>
                        <p class="mb-6">Vizyon rengarenk insanlardan oluÅŸan bir topluluk ve neden bu rengarenk zevklerden oluÅŸan bir playlistimiz olmasÄ±n? Sen de bir renk katmayÄ± unutma!</p>
                        <a href="https://open.spotify.com/playlist/1tGeLgECLa3lDx3X1DYzlN?si=5kI9UGfaRLu7GE0lcPcM9Q" target="_blank" class="inline-flex items-center px-6 py-3 bg-white text-purple-700 rounded-lg font-medium hover:bg-gray-100 transition">
                            <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
                            </svg>
                            Spotify Playlist'e Git
                        </a>
                    </div>
                </div>
            </section>

            <!-- Admin Panel Section -->
            <section id="admin-section" class="mb-12 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Admin Paneli</h2>
                </div>

                <!-- Admin Tabs -->
                <div class="mb-6 border-b border-gray-200">
                    <div class="flex overflow-x-auto">
                        <button id="admin-tab-users" class="admin-tab tab-active px-6 py-3 text-gray-700 whitespace-nowrap">
                            KullanÄ±cÄ±lar
                        </button>
                        <button id="admin-tab-comments" class="admin-tab px-6 py-3 text-gray-700 whitespace-nowrap">
                            Yorumlar
                        </button>
                        <button id="admin-tab-content" class="admin-tab px-6 py-3 text-gray-700 whitespace-nowrap">
                            Ä°Ã§erikler
                        </button>
                        <button id="admin-tab-logs" class="admin-tab px-6 py-3 text-gray-700 whitespace-nowrap">
                            Log KayÄ±tlarÄ±
                        </button>
                    </div>
                </div>

                <!-- Users Management -->
                <div id="admin-users" class="admin-content">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="px-6 py-4 bg-gray-50 border-b">
                            <h3 class="text-lg font-semibold text-gray-800">KullanÄ±cÄ± YÃ¶netimi</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">KullanÄ±cÄ±</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">YaÅŸ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cinsiyet</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ä°zlenen/Okunan</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Comments Management -->
                <div id="admin-comments" class="admin-content hidden">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="px-6 py-4 bg-gray-50 border-b">
                            <h3 class="text-lg font-semibold text-gray-800">Yorum YÃ¶netimi</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4" id="admin-comments-list">
                                <!-- Comments will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Management -->
                <div id="admin-content" class="admin-content hidden">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="px-6 py-4 bg-gray-50 border-b">
                            <h3 class="text-lg font-semibold text-gray-800">Ä°Ã§erik YÃ¶netimi</h3>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="admin-content-list">
                                <!-- Content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Management -->
                <div id="admin-logs" class="admin-content hidden">
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="px-6 py-4 bg-gray-50 border-b">
                            <h3 class="text-lg font-semibold text-gray-800">Sistem Log KayÄ±tlarÄ±</h3>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4" id="admin-logs-list">
                                <!-- Logs will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile-section" class="mb-12 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Profilim</h2>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">KiÅŸisel Bilgiler</h3>
                        <div id="profile-info" class="space-y-2">
                            <!-- Profile info will be loaded here -->
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Ä°zlediÄŸim/OkuduÄŸum Ä°Ã§erikler</h3>
                        <div id="watched-content" class="space-y-3">
                            <!-- Watched content will be loaded here -->
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">YorumlarÄ±m</h3>
                        <div id="my-comments" class="space-y-3">
                            <!-- User comments will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <p>Â© 2023 Vizyon Kitap ve Film KulÃ¼bÃ¼</p>
                    </div>
                    <div class="flex space-x-4">
                        <a href="#" class="hover:text-purple-400 transition">HakkÄ±mÄ±zda</a>
                        <a href="#" class="hover:text-purple-400 transition">Ä°letiÅŸim</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold">GiriÅŸ Yap</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </div>
                </div>
                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="login-email">
                            Email
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="login-email" type="email" placeholder="Email" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="login-password">
                            Åžifre
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="login-password" type="password" placeholder="******************" required>
                    </div>
                    <div class="flex items-center justify-between">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                            GiriÅŸ Yap
                        </button>
                    </div>
                    <div id="login-error" class="text-red-500 text-sm mt-4 hidden"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold">KayÄ±t Ol</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </div>
                </div>
                <form id="register-form">
                    <div class="mb-4 flex space-x-4">
                        <div class="w-1/2">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="register-firstname">
                                Ad
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-firstname" type="text" placeholder="Ad" required>
                        </div>
                        <div class="w-1/2">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="register-lastname">
                                Soyad
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-lastname" type="text" placeholder="Soyad" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="register-email">
                            Email
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-email" type="email" placeholder="Email" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="register-password">
                            Åžifre
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-password" type="password" placeholder="******************" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="register-age">
                            YaÅŸ
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-age" type="number" min="13" max="120" placeholder="YaÅŸ" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="register-gender">
                            Cinsiyet
                        </label>
                        <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="register-gender" required>
                            <option value="">SeÃ§iniz</option>
                            <option value="Erkek">Erkek</option>
                            <option value="KadÄ±n">KadÄ±n</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                            KayÄ±t Ol
                        </button>
                    </div>
                    <div id="register-error" class="text-red-500 text-sm mt-4 hidden"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div id="comment-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold" id="comment-modal-title">Yorum Yap</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </div>
                </div>
                <form id="comment-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Puan (1-10)
                        </label>
                        <div class="rating-input flex space-x-1" id="rating-stars">
                            <!-- Stars will be generated here -->
                        </div>
                        <input type="hidden" id="rating-value" name="rating" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="comment-text">
                            Yorumunuz
                        </label>
                        <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="comment-text" rows="4" placeholder="Yorumunuzu yazÄ±n..." required></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="watched-checkbox" class="mr-2">
                            <span class="text-gray-700 text-sm">Ä°zledim/Okudum</span>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                            Yorum GÃ¶nder
                        </button>
                    </div>
                    <div id="comment-error" class="text-red-500 text-sm mt-4 hidden"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Content Modal -->
    <div id="add-content-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold" id="add-content-modal-title">Ä°Ã§erik Ekle</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </div>
                </div>
                <form id="add-content-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-name">
                            Ä°sim
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-name" type="text" placeholder="Ä°Ã§erik adÄ±" required>
                    </div>
                    <div class="mb-4" id="year-field">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-year">
                            YÄ±l
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-year" type="text" placeholder="YÄ±l">
                    </div>
                    <div class="mb-4" id="author-field" style="display: none;">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-author">
                            Yazar
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-author" type="text" placeholder="Yazar adÄ±">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-image">
                            Resim URL
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-image" type="url" placeholder="https://...">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-date-range">
                            Tarih AralÄ±ÄŸÄ±
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-date-range" type="text" placeholder="Ã–rn: 21-25 Temmuz">
                    </div>
                    <div class="mb-4" id="pdf-field" style="display: none;">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="content-pdf">
                            PDF URL
                        </label>
                        <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content-pdf" type="url" placeholder="https://...">
                    </div>
                    <input type="hidden" id="content-type" name="type">
                    <div class="flex items-center justify-between">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                            Ekle
                        </button>
                    </div>
                    <div id="add-content-error" class="text-red-500 text-sm mt-4 hidden"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-2xl mx-auto rounded shadow-lg z-50 overflow-y-auto max-h-screen">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold" id="user-profile-modal-title">KullanÄ±cÄ± Profili</p>
                    <div class="modal-close cursor-pointer z-50">
                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
                        </svg>
                    </div>
                </div>
                <div id="user-profile-content">
                    <!-- User profile content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let isGuest = false;
        let contents = [];
        let comments = [];
        let currentContentId = null;
        let currentContentTitle = null;
        let currentContentType = null;

        // DOM elements
        const welcomeScreen = document.getElementById('welcome-screen');
        const mainApp = document.getElementById('main-app');
        const loadingIndicator = document.getElementById('loading');
        const userLoggedOut = document.getElementById('user-logged-out');
        const userLoggedIn = document.getElementById('user-logged-in');
        const userNameDisplay = document.getElementById('user-name-display');
        const userDropdown = document.getElementById('user-dropdown');
        const btnAdminPanel = document.getElementById('btn-admin-panel');
        const adminElements = document.querySelectorAll('.admin-only');
        const guestNotice = document.getElementById('guest-notice');

        const btnFilms = document.getElementById('btn-films');
        const btnBooks = document.getElementById('btn-books');
        const btnMusic = document.getElementById('btn-music');
        const btnProfile = document.getElementById('btn-profile');
        const btnLogin = document.getElementById('btn-login');
        const btnRegister = document.getElementById('btn-register');
        const btnLogout = document.getElementById('btn-logout');

        const welcomeLoginBtn = document.getElementById('welcome-login-btn');
        const welcomeRegisterBtn = document.getElementById('welcome-register-btn');
        const welcomeGuestBtn = document.getElementById('welcome-guest-btn');

        const filmsSection = document.getElementById('films-section');
        const booksSection = document.getElementById('books-section');
        const musicSection = document.getElementById('music-section');

        const filmTabsContainer = document.getElementById('film-tabs');
        const filmCardsContainer = document.getElementById('film-cards');
        const bookCardsContainer = document.getElementById('book-cards');

        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const commentModal = document.getElementById('comment-modal');
        const addContentModal = document.getElementById('add-content-modal');

        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const commentForm = document.getElementById('comment-form');
        const addContentForm = document.getElementById('add-content-form');

        const addFilmBtn = document.getElementById('add-film-btn');
        const addBookBtn = document.getElementById('add-book-btn');

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            setupAuthStateListener();
            // Check if user is already logged in
            checkExistingAuth();
        });

        function setupAuthStateListener() {
            window.firebaseAuth.onAuthStateChanged(window.auth, async (user) => {
                if (user && !isGuest) {
                    try {
                        // Get user data from Firestore to check role
                        const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', user.uid));
                        
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            currentUser = {
                                id: user.uid,
                                name: userData.ad + ' ' + userData.soyad,
                                email: user.email,
                                role: userData.role || 'user'
                            };
                            
                            // Check if admin
                            isAdmin = userData.role === 'admin';
                        } else {
                            currentUser = {
                                id: user.uid,
                                name: user.displayName || user.email.split('@')[0],
                                email: user.email,
                                role: 'user'
                            };
                            isAdmin = false;
                        }
                        
                        // Clear guest mode when user logs in
                        isGuest = false;
                        showMainApp();
                    } catch (error) {
                        console.error('Error fetching user data:', error);
                        currentUser = {
                            id: user.uid,
                            name: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            role: 'user'
                        };
                        isAdmin = false;
                        isGuest = false;
                        showMainApp();
                    }
                } else if (!user && !isGuest) {
                    // User is not logged in and not a guest
                    currentUser = null;
                    isAdmin = false;
                    welcomeScreen.classList.remove('hidden');
                    mainApp.classList.add('hidden');
                }
            });
        }

        function checkExistingAuth() {
            // Show loading while checking auth state
            showLoading();
            
            // Firebase will automatically trigger onAuthStateChanged
            // We'll hide loading in the auth state change handler or after a timeout
            setTimeout(() => {
                if (welcomeScreen.classList.contains('hidden') && mainApp.classList.contains('hidden')) {
                    // If neither screen is shown, show welcome screen
                    welcomeScreen.classList.remove('hidden');
                    hideLoading();
                }
            }, 3000); // 3 second timeout
        }

        function setupEventListeners() {
            // Welcome screen buttons
            welcomeLoginBtn.addEventListener('click', () => {
                showModal('login-modal');
            });

            welcomeRegisterBtn.addEventListener('click', () => {
                showModal('register-modal');
            });

            welcomeGuestBtn.addEventListener('click', () => {
                loginAsGuest();
            });

            // Navigation buttons
            btnFilms.addEventListener('click', () => {
                switchSection('films');
            });

            btnBooks.addEventListener('click', () => {
                switchSection('books');
            });

            btnMusic.addEventListener('click', () => {
                switchSection('music');
            });

            // Profile and admin buttons
            btnProfile.addEventListener('click', () => {
                switchSection('profile');
                loadUserProfile();
            });

            btnAdminPanel.addEventListener('click', () => {
                // Double check admin access
                if (!currentUser || isGuest || currentUser.role !== 'admin') {
                    alert('Bu sayfaya eriÅŸim yetkiniz bulunmuyor.');
                    return;
                }
                switchSection('admin');
                loadAdminData();
            });

            // User buttons
            btnLogin.addEventListener('click', () => {
                showModal('login-modal');
            });

            btnRegister.addEventListener('click', () => {
                showModal('register-modal');
            });

            btnLogout.addEventListener('click', () => {
                logout();
            });

            // User menu dropdown
            document.getElementById('user-menu-button').addEventListener('click', () => {
                userDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#user-logged-in')) {
                    userDropdown.classList.add('hidden');
                }
            });

            // Add content buttons
            addFilmBtn.addEventListener('click', () => {
                openAddContentModal('film');
            });

            addBookBtn.addEventListener('click', () => {
                openAddContentModal('kitap');
            });

            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', () => {
                    const modal = button.closest('.modal');
                    hideModal(modal.id);
                });
            });

            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', () => {
                    const modal = overlay.closest('.modal');
                    hideModal(modal.id);
                });
            });

            // Form submissions
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleLogin();
            });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleRegister();
            });

            commentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleCommentSubmit();
            });

            addContentForm.addEventListener('submit', (e) => {
                e.preventDefault();
                handleAddContent();
            });

            // Film tabs
            filmTabsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('film-tab')) {
                    filterFilms(e.target);
                }
            });

            // Setup rating stars
            setupRatingStars();

            // Admin tabs
            document.getElementById('admin-tab-users').addEventListener('click', () => {
                switchAdminTab('users');
            });

            document.getElementById('admin-tab-comments').addEventListener('click', () => {
                switchAdminTab('comments');
            });

            document.getElementById('admin-tab-content').addEventListener('click', () => {
                switchAdminTab('content');
            });

            document.getElementById('admin-tab-logs').addEventListener('click', () => {
                switchAdminTab('logs');
            });
        }

        function setupRatingStars() {
            const ratingContainer = document.getElementById('rating-stars');
            const ratingValue = document.getElementById('rating-value');
            
            for (let i = 1; i <= 10; i++) {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="radio" name="rating" value="${i}">
                    <svg class="empty" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                `;
                
                label.addEventListener('click', () => {
                    ratingValue.value = i;
                    updateStarDisplay(i);
                });
                
                ratingContainer.appendChild(label);
            }
        }

        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('#rating-stars svg');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('empty');
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                    star.classList.add('empty');
                }
            });
        }

        function loginAsGuest() {
            currentUser = {
                id: 'guest',
                name: 'Misafir KullanÄ±cÄ±',
                email: 'misafir@example.com',
                role: 'guest',
                isGuest: true
            };
            isGuest = true;
            showMainApp();
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');

            try {
                showLoading();
                const userCredential = await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                
                // Get user data for logging
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid));
                let userName = userCredential.user.displayName || userCredential.user.email.split('@')[0];
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userName = `${userData.ad} ${userData.soyad}`;
                }
                
                // Create login log entry
                await createLog('KullanÄ±cÄ± GiriÅŸi', `${userName} sisteme giriÅŸ yaptÄ±.`);
                
                hideModal('login-modal');
                
                // Clear form
                document.getElementById('login-form').reset();
                errorDiv.classList.add('hidden');
                
            } catch (error) {
                hideLoading();
                errorDiv.textContent = getFirebaseErrorMessage(error.code);
                errorDiv.classList.remove('hidden');
            }
        }

        async function handleRegister() {
            const firstName = document.getElementById('register-firstname').value;
            const lastName = document.getElementById('register-lastname').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const age = document.getElementById('register-age').value;
            const gender = document.getElementById('register-gender').value;
            const errorDiv = document.getElementById('register-error');

            try {
                showLoading();
                const userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(window.auth, email, password);
                
                // Update profile with display name
                await window.firebaseAuth.updateProfile(userCredential.user, {
                    displayName: `${firstName} ${lastName}`
                });

                // Save additional user data to Firestore
                await window.firestore.setDoc(window.firestore.doc(window.db, 'users', userCredential.user.uid), {
                    ad: firstName,
                    soyad: lastName,
                    email: email,
                    yas: parseInt(age),
                    cinsiyet: gender,
                    role: 'user',
                    profilOlusturmaTarihi: new Date()
                });

                // Create registration log entry
                await createLog('KullanÄ±cÄ± KaydÄ±', `${firstName} ${lastName} sisteme kayÄ±t oldu.`);

                hideModal('register-modal');
                
                // Clear form
                document.getElementById('register-form').reset();
                errorDiv.classList.add('hidden');
                
            } catch (error) {
                hideLoading();
                errorDiv.textContent = getFirebaseErrorMessage(error.code);
                errorDiv.classList.remove('hidden');
            }
        }

        async function createLog(action, details) {
            try {
                const logData = {
                    action: action,
                    details: details,
                    userId: currentUser ? currentUser.id : 'system',
                    userName: currentUser ? currentUser.name : 'Sistem',
                    timestamp: new Date()
                };

                await window.firestore.addDoc(window.firestore.collection(window.db, 'logs'), logData);
            } catch (error) {
                console.error('Log oluÅŸturulurken hata:', error);
            }
        }

        async function handleCommentSubmit() {
            const rating = document.getElementById('rating-value').value;
            const commentText = document.getElementById('comment-text').value;
            const watched = document.getElementById('watched-checkbox').checked;
            const errorDiv = document.getElementById('comment-error');

            if (!rating) {
                errorDiv.textContent = 'LÃ¼tfen bir puan seÃ§in.';
                errorDiv.classList.remove('hidden');
                return;
            }

            try {
                showLoading();
                
                const commentData = {
                    icerikId: currentContentId,
                    icerikAdi: currentContentTitle,
                    icerikTuru: currentContentType,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    puan: parseInt(rating),
                    yorum: commentText,
                    izlendi: watched,
                    verified: false,
                    timestamp: new Date()
                };

                await window.firestore.addDoc(window.firestore.collection(window.db, 'yorumlar'), commentData);
                
                // Create log entry with more details
                const watchedText = watched ? ' (Ä°zlendi/Okundu olarak iÅŸaretlendi)' : '';
                await createLog('Yorum Eklendi', `${currentUser.name} kullanÄ±cÄ±sÄ± "${currentContentTitle}" (${currentContentType}) iÃ§in ${rating}/10 puan vererek yorum yaptÄ±${watchedText}.`);
                
                hideModal('comment-modal');
                await loadData(); // Reload data to show new comment
                hideLoading();
                
                // Reset form
                document.getElementById('rating-value').value = '';
                document.getElementById('comment-text').value = '';
                document.getElementById('watched-checkbox').checked = false;
                updateStarDisplay(0);
                
            } catch (error) {
                hideLoading();
                errorDiv.textContent = 'Yorum gÃ¶nderilirken hata oluÅŸtu: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }

        async function handleAddContent() {
            const name = document.getElementById('content-name').value;
            const year = document.getElementById('content-year').value;
            const author = document.getElementById('content-author').value;
            const image = document.getElementById('content-image').value;
            const dateRange = document.getElementById('content-date-range').value;
            const pdfUrl = document.getElementById('content-pdf').value;
            const type = document.getElementById('content-type').value;
            const errorDiv = document.getElementById('add-content-error');

            try {
                showLoading();
                
                const contentData = {
                    name: name,
                    tur: type,
                    tarih_araligi: dateRange,
                    image: image,
                    createdAt: new Date()
                };

                if (type === 'film') {
                    contentData.year = year;
                } else if (type === 'kitap') {
                    contentData.author = author;
                    if (pdfUrl) contentData.pdfUrl = pdfUrl;
                }

                await window.firestore.addDoc(window.firestore.collection(window.db, 'icerikler'), contentData);
                
                // Create log entry for content addition
                const contentTypeText = type === 'film' ? 'Film' : 'Kitap';
                const additionalInfo = type === 'film' ? (year ? ` (${year})` : '') : (author ? ` - ${author}` : '');
                await createLog('Ä°Ã§erik Eklendi', `${currentUser.name} tarafÄ±ndan "${name}"${additionalInfo} ${contentTypeText.toLowerCase()}u eklendi.`);
                
                hideModal('add-content-modal');
                await loadData(); // Reload data to show new content
                hideLoading();
                
                // Reset form
                document.getElementById('add-content-form').reset();
                
            } catch (error) {
                hideLoading();
                errorDiv.textContent = 'Ä°Ã§erik eklenirken hata oluÅŸtu: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }

        function openAddContentModal(type) {
            const modal = document.getElementById('add-content-modal');
            const title = document.getElementById('add-content-modal-title');
            const yearField = document.getElementById('year-field');
            const authorField = document.getElementById('author-field');
            const pdfField = document.getElementById('pdf-field');
            const contentType = document.getElementById('content-type');

            contentType.value = type;

            if (type === 'film') {
                title.textContent = 'Film Ekle';
                yearField.style.display = 'block';
                authorField.style.display = 'none';
                pdfField.style.display = 'none';
            } else if (type === 'kitap') {
                title.textContent = 'Kitap Ekle';
                yearField.style.display = 'none';
                authorField.style.display = 'block';
                pdfField.style.display = 'block';
            }

            showModal('add-content-modal');
        }

        function openCommentModal(contentId, contentTitle, contentType) {
            if (isGuest) {
                showModal('login-modal');
                return;
            }

            if (!currentUser) {
                showModal('login-modal');
                return;
            }

            currentContentId = contentId;
            currentContentTitle = contentTitle;
            currentContentType = contentType;

            document.getElementById('comment-modal-title').textContent = `${contentTitle} iÃ§in Yorum`;
            showModal('comment-modal');
        }

        async function logout() {
            try {
                // Create log entry for logout before clearing user data
                if (currentUser && !isGuest) {
                    await createLog('KullanÄ±cÄ± Ã‡Ä±kÄ±ÅŸÄ±', `${currentUser.name} sistemden Ã§Ä±kÄ±ÅŸ yaptÄ±.`);
                }
                
                if (!isGuest) {
                    await window.firebaseAuth.signOut(window.auth);
                }
                
                currentUser = null;
                isAdmin = false;
                isGuest = false;
                
                // Firebase auth state change will handle UI updates
                // But we can also manually update for immediate feedback
                welcomeScreen.classList.remove('hidden');
                mainApp.classList.add('hidden');
                userLoggedIn.classList.add('hidden');
                userLoggedOut.classList.remove('hidden');
                userDropdown.classList.add('hidden');
                guestNotice.classList.add('hidden');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function updateUIForLoggedInUser() {
            userNameDisplay.textContent = currentUser.name;
            userLoggedOut.classList.add('hidden');
            userLoggedIn.classList.remove('hidden');

            if (isGuest) {
                guestNotice.classList.remove('hidden');
                btnProfile.style.display = 'none';
                // Hide admin panel for guest users
                btnAdminPanel.classList.add('hidden');
                adminElements.forEach(el => el.classList.add('hidden'));
            } else {
                guestNotice.classList.add('hidden');
                btnProfile.style.display = 'block';
                
                // Only show admin panel if user is actually admin (not guest)
                if (isAdmin && currentUser.role === 'admin') {
                    btnAdminPanel.classList.remove('hidden');
                    adminElements.forEach(el => el.classList.remove('hidden'));
                } else {
                    btnAdminPanel.classList.add('hidden');
                    adminElements.forEach(el => el.classList.add('hidden'));
                }
            }
        }

        function showMainApp() {
            welcomeScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            hideLoading(); // Hide loading when showing main app

            if (currentUser) {
                updateUIForLoggedInUser();
            } else {
                userLoggedOut.classList.remove('hidden');
                userLoggedIn.classList.add('hidden');
                guestNotice.classList.add('hidden');
            }

            loadData();
        }

        async function loadData() {
            showLoading();

            try {
                // Load contents from Firebase
                const contentsSnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'icerikler'));
                contents = [];
                contentsSnapshot.forEach((doc) => {
                    contents.push({ id: doc.id, ...doc.data() });
                });

                // Load comments from Firebase
                const commentsSnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'yorumlar'));
                comments = [];
                commentsSnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Convert Firestore timestamp to Date
                    if (data.timestamp && data.timestamp.toDate) {
                        data.timestamp = data.timestamp.toDate();
                    }
                    comments.push({ id: doc.id, ...data });
                });

            } catch (error) {
                console.error('Firebase veri yÃ¼kleme hatasÄ±:', error);
                // If Firebase fails, keep arrays empty
                contents = [];
                comments = [];
            }

            renderFilmTabs();
            renderFilms();
            renderBooks();
            hideLoading();
        }

        function renderFilmTabs() {
            const allFilmsTab = filmTabsContainer.querySelector('[data-tab="all"]');
            filmTabsContainer.innerHTML = '';
            filmTabsContainer.appendChild(allFilmsTab);

            const films = contents.filter(content => content.tur === "film");
            const uniqueFilmNames = [...new Set(films.map(film => film.name))];

            uniqueFilmNames.forEach(filmName => {
                const film = films.find(f => f.name === filmName);
                if (film) {
                    const tab = document.createElement('button');
                    tab.className = 'film-tab px-6 py-3 text-gray-700 whitespace-nowrap';
                    tab.textContent = film.name;
                    tab.dataset.tab = film.id;
                    filmTabsContainer.appendChild(tab);
                }
            });
        }

        function renderFilms(filterId = null) {
            filmCardsContainer.innerHTML = '';
            
            let filmsToRender = contents.filter(content => content.tur === "film");
            
            if (filterId) {
                filmsToRender = filmsToRender.filter(film => film.id === filterId);
            }

            if (filmsToRender.length === 0) {
                filmCardsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">HenÃ¼z film eklenmemiÅŸ.</p>';
                return;
            }

            filmsToRender.forEach(film => {
                const filmComments = comments.filter(comment => comment.icerikId === film.id);
                let avgRating = 0;
                if (filmComments.length > 0) {
                    avgRating = filmComments.reduce((sum, comment) => sum + comment.puan, 0) / filmComments.length;
                }

                const card = createContentCard(film, avgRating, filmComments, "film");
                filmCardsContainer.appendChild(card);
            });
        }

        function renderBooks() {
            bookCardsContainer.innerHTML = '';
            
            const books = contents.filter(content => content.tur === "kitap");

            if (books.length === 0) {
                bookCardsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">HenÃ¼z kitap eklenmemiÅŸ.</p>';
                return;
            }

            books.forEach(book => {
                const bookComments = comments.filter(comment => comment.icerikId === book.id);
                let avgRating = 0;
                if (bookComments.length > 0) {
                    avgRating = bookComments.reduce((sum, comment) => sum + comment.puan, 0) / bookComments.length;
                }

                const card = createBookCard(book, avgRating, bookComments);
                bookCardsContainer.appendChild(card);
            });
        }

        function createContentCard(content, avgRating, contentComments, type) {
            const container = document.createElement('div');
            container.className = 'bg-white rounded-xl shadow-md overflow-hidden movie-card';

            const imageUrl = content.image && content.image.trim() !== '' ? content.image : 'https://via.placeholder.com/300x450?text=No+Image';
            const isGuestUser = isGuest;
            const buttonText = isGuestUser ? 'Yorum iÃ§in GiriÅŸ YapÄ±n' : 'Yorum Yap';
            const buttonClass = isGuestUser ? 'guest-comment-btn px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition' : 'comment-btn px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition';

            const cardContent = `
                <div class="md:flex">
                    <div class="md:flex-shrink-0">
                        <div class="h-64 md:w-48 bg-purple-100 relative">
                            <img src="${imageUrl}" alt="${content.name}" class="w-full h-full object-cover">
                            <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
                                ${avgRating > 0 ? avgRating.toFixed(1) : 'N/A'}
                            </div>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col justify-between w-full">
                        <div>
                            <h3 class="text-2xl font-semibold text-gray-800">${content.name}</h3>
                            <p class="text-gray-600 mt-1">${content.year || ''}</p>
                            ${content.author ? `<p class="text-purple-600 mt-1 font-medium">Yazar: ${content.author}</p>` : ''}
                            ${content.tarih_araligi ? `<p class="text-purple-600 mt-1 font-medium">${content.tarih_araligi}</p>` : ''}
                        </div>
                        <div class="mt-6 flex justify-between items-end">
                            <span class="text-sm text-gray-500">${contentComments.length} yorum</span>
                            
                            <div class="flex flex-col items-end space-y-2">
                                <div class="flex space-x-2">
                                    <button class="${buttonClass}" data-id="${content.id}" data-title="${content.name}" data-type="${type}">
                                        ${buttonText}
                                    </button>
                                    <button class="toggle-details px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-id="${content.id}">
                                        YorumlarÄ± GÃ¶ster
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="film-details border-t border-gray-200 p-6" id="details-${content.id}">
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Yorumlar ve Puanlar</h4>
                        <div class="space-y-4" id="all-comments-${content.id}">
                            ${renderCommentsHTML(contentComments)}
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = cardContent;

            // Add event listeners
            container.querySelector('.toggle-details').addEventListener('click', (e) => {
                const contentId = e.target.dataset.id;
                toggleContentDetails(contentId);
            });

            const commentBtn = container.querySelector('.guest-comment-btn, .comment-btn');
            if (commentBtn) {
                commentBtn.addEventListener('click', (e) => {
                    const contentId = e.target.dataset.id;
                    const contentTitle = e.target.dataset.title;
                    const contentType = e.target.dataset.type;
                    openCommentModal(contentId, contentTitle, contentType);
                });
            }



            return container;
        }

        function createBookCard(book, avgRating, bookComments) {
            const container = document.createElement('div');
            container.className = 'bg-white rounded-xl shadow-md overflow-hidden book-card';

            const imageUrl = book.image && book.image.trim() !== '' ? book.image : 'https://via.placeholder.com/300x450?text=No+Image';
            const hasPdf = book.pdfUrl && book.pdfUrl.trim() !== '';
            const isGuestUser = isGuest;
            const buttonText = isGuestUser ? 'Yorum iÃ§in GiriÅŸ YapÄ±n' : 'Yorum Yap';
            const buttonClass = isGuestUser ? 'guest-comment-btn w-full px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition' : 'comment-btn w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition';

            const cardContent = `
                <div class="book-card-content">
                    <div class="relative">
                        <img src="${imageUrl}" alt="${book.name}" class="w-full book-image">
                        <div class="absolute top-2 right-2 bg-purple-600 text-white rounded-full px-2 py-1 text-sm font-semibold">
                            ${avgRating > 0 ? avgRating.toFixed(1) : 'N/A'}
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${book.name}</h3>
                        ${book.author ? `<p class="text-purple-600 font-medium mb-2">Yazar: ${book.author}</p>` : ''}
                        ${book.tarih_araligi ? `<p class="text-gray-600 mb-4">${book.tarih_araligi}</p>` : ''}
                        
                        <div class="flex items-center mb-4">
                            <span class="text-sm text-gray-500">${bookComments.length} yorum</span>
                            ${hasPdf ? `
                                <a href="${book.pdfUrl}" target="_blank" class="pdf-download-btn inline-flex items-center text-sm text-purple-600 hover:text-purple-800 ml-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    PDF Ä°ndir
                                </a>
                            ` : ''}
                        </div>
                        
                        <div class="book-actions flex flex-col space-y-2">
                            <button class="${buttonClass}" data-id="${book.id}" data-title="${book.name}" data-type="kitap">
                                ${buttonText}
                            </button>
                            <button class="toggle-details w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition" data-id="${book.id}">
                                YorumlarÄ± GÃ¶ster
                            </button>
                        </div>
                    </div>
                </div>
                <div class="book-details border-t border-gray-200 p-6" id="details-${book.id}">
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Yorumlar ve Puanlar</h4>
                        <div class="space-y-4" id="all-comments-${book.id}">
                            ${renderCommentsHTML(bookComments)}
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = cardContent;

            // Add event listeners
            container.querySelector('.toggle-details').addEventListener('click', (e) => {
                const contentId = e.target.dataset.id;
                toggleContentDetails(contentId);
            });

            const commentBtn = container.querySelector('.guest-comment-btn, .comment-btn');
            if (commentBtn) {
                commentBtn.addEventListener('click', (e) => {
                    const contentId = e.target.dataset.id;
                    const contentTitle = e.target.dataset.title;
                    const contentType = e.target.dataset.type;
                    openCommentModal(contentId, contentTitle, contentType);
                });
            }



            return container;
        }

        async function deleteContent(contentId) {
            try {
                showLoading();
                
                // Get content data first for logging
                const contentDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'icerikler', contentId));
                const contentData = contentDoc.data();
                
                await window.firestore.deleteDoc(window.firestore.doc(window.db, 'icerikler', contentId));
                
                // Create log entry for content deletion
                if (contentData) {
                    const contentTypeText = contentData.tur === 'film' ? 'Film' : 'Kitap';
                    const additionalInfo = contentData.tur === 'film' ? (contentData.year ? ` (${contentData.year})` : '') : (contentData.author ? ` - ${contentData.author}` : '');
                    await createLog('Ä°Ã§erik Silindi', `${currentUser.name} tarafÄ±ndan "${contentData.name}"${additionalInfo} ${contentTypeText.toLowerCase()}u silindi.`);
                }
                
                await loadData(); // Reload data
                hideLoading();
            } catch (error) {
                hideLoading();
                alert('Ä°Ã§erik silinirken hata oluÅŸtu: ' + error.message);
            }
        }

        function renderCommentsHTML(contentComments) {
            if (!contentComments || contentComments.length === 0) {
                return '<p class="text-gray-500">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.</p>';
            }

            const verifiedBadgeUrl = "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Twitter_Verified_Badge.svg/2048px-Twitter_Verified_Badge.svg.png";

            const sortedComments = [...contentComments].sort((a, b) => {
                if (a.verified && !b.verified) return -1;
                if (!a.verified && b.verified) return 1;
                return new Date(b.timestamp) - new Date(a.timestamp);
            });

            return sortedComments.map(comment => {
                const isVerified = comment.verified === true;
                const commentClass = isVerified ? 'featured-comment rounded-lg p-4' : 'bg-gray-50 rounded-lg p-4';
                const verifiedBadge = isVerified ? `<img src="${verifiedBadgeUrl}" alt="Verified" class="verified-badge ml-1">` : '';
                const formattedDate = comment.timestamp instanceof Date ? 
                    comment.timestamp.toLocaleDateString('tr-TR') : 
                    new Date(comment.timestamp).toLocaleDateString('tr-TR');

                return `
                    <div class="${commentClass}" data-comment-id="${comment.id}">
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="font-semibold text-gray-800 flex items-center">
                                    ${comment.userName || 'Anonim'} ${verifiedBadge}
                                </h5>
                                <span class="text-xs text-gray-500">${formattedDate}</span>
                            </div>
                            <div class="flex items-center">
                                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                                <span class="ml-1 text-gray-700">${comment.puan}/10</span>
                            </div>
                        </div>
                        <p class="mt-2 text-gray-600">${comment.yorum || ''}</p>
                    </div>
                `;
            }).join('');
        }

        function toggleContentDetails(contentId) {
            const detailsSection = document.getElementById(`details-${contentId}`);
            const toggleButton = document.querySelector(`.toggle-details[data-id="${contentId}"]`);

            if (detailsSection.classList.contains('active')) {
                detailsSection.classList.remove('active');
                toggleButton.textContent = 'YorumlarÄ± GÃ¶ster';
            } else {
                detailsSection.classList.add('active');
                toggleButton.textContent = 'YorumlarÄ± Gizle';
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100');
            document.body.classList.add('modal-active');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.classList.remove('opacity-100');
            document.body.classList.remove('modal-active');
            
            // Clear error messages
            const errorDivs = modal.querySelectorAll('[id$="-error"]');
            errorDivs.forEach(div => {
                div.classList.add('hidden');
                div.textContent = '';
            });
        }

        function showLoading() {
            loadingIndicator.classList.remove('hidden');
        }

        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }

        function switchSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`${section}-section`).classList.remove('hidden');
        }

        function filterFilms(tabElement) {
            document.querySelectorAll('.film-tab').forEach(tab => tab.classList.remove('tab-active'));
            tabElement.classList.add('tab-active');

            const tabId = tabElement.dataset.tab;
            if (tabId === 'all') {
                renderFilms();
            } else {
                renderFilms(tabId);
            }
        }

        function switchAdminTab(tab) {
            // Security check - only allow admin users
            if (!currentUser || isGuest || currentUser.role !== 'admin') {
                alert('Bu sayfaya eriÅŸim yetkiniz bulunmuyor.');
                return;
            }

            // Update tab styles
            document.querySelectorAll('.admin-tab').forEach(t => {
                t.classList.remove('tab-active', 'border-purple-500');
                t.classList.add('border-transparent');
            });
            
            document.getElementById(`admin-tab-${tab}`).classList.add('tab-active', 'border-purple-500');
            document.getElementById(`admin-tab-${tab}`).classList.remove('border-transparent');

            // Show/hide content
            document.querySelectorAll('.admin-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(`admin-${tab}`).classList.remove('hidden');

            // Load specific data
            if (tab === 'users') {
                loadUsersData();
            } else if (tab === 'comments') {
                loadCommentsData();
            } else if (tab === 'content') {
                loadContentData();
            } else if (tab === 'logs') {
                loadLogsData();
            }
        }

        async function loadAdminData() {
            // Security check - only allow admin users
            if (!currentUser || isGuest || currentUser.role !== 'admin') {
                alert('Bu sayfaya eriÅŸim yetkiniz bulunmuyor.');
                switchSection('films');
                return;
            }
            switchAdminTab('users');
        }

        async function loadUsersData() {
            try {
                showLoading();
                
                // Load users from Firebase
                const usersSnapshot = await window.firestore.getDocs(window.firestore.collection(window.db, 'users'));
                const users = [];
                usersSnapshot.forEach((doc) => {
                    users.push({ id: doc.id, ...doc.data() });
                });

                const usersTableBody = document.getElementById('users-table-body');
                usersTableBody.innerHTML = '';

                users.forEach(user => {
                    // Get user's watched content
                    const userComments = comments.filter(comment => comment.userId === user.id && comment.izlendi);
                    const watchedCount = userComments.length;
                    const watchedItems = userComments.map(comment => comment.icerikAdi).join(', ');

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <button class="text-sm font-medium text-blue-600 hover:text-blue-800 underline view-user-profile" data-user-id="${user.id}">
                                ${user.ad} ${user.soyad}
                            </button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${user.email}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${user.yas || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${user.cinsiyet || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${user.role === 'admin' ? 'Admin' : 'KullanÄ±cÄ±'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900" title="${watchedItems}">
                                ${watchedCount} iÃ§erik
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="make-admin-btn text-indigo-600 hover:text-indigo-900 mr-3" data-user-id="${user.id}" ${user.role === 'admin' ? 'style="display:none"' : ''}>
                                Admin Yap
                            </button>
                            <button class="delete-user-btn text-red-600 hover:text-red-900" data-user-id="${user.id}">
                                Sil
                            </button>
                        </td>
                    `;

                    // Add event listeners
                    const viewProfileBtn = row.querySelector('.view-user-profile');
                    const makeAdminBtn = row.querySelector('.make-admin-btn');
                    const deleteUserBtn = row.querySelector('.delete-user-btn');

                    viewProfileBtn.addEventListener('click', () => {
                        showUserProfile(user);
                    });

                    if (makeAdminBtn) {
                        makeAdminBtn.addEventListener('click', async () => {
                            if (confirm('Bu kullanÄ±cÄ±yÄ± admin yapmak istediÄŸinizden emin misiniz?')) {
                                await makeUserAdmin(user.id);
                            }
                        });
                    }

                    deleteUserBtn.addEventListener('click', async () => {
                        if (confirm('Bu kullanÄ±cÄ±yÄ± silmek istediÄŸinizden emin misiniz?')) {
                            await deleteUser(user.id);
                        }
                    });

                    usersTableBody.appendChild(row);
                });

                hideLoading();
            } catch (error) {
                hideLoading();
                console.error('KullanÄ±cÄ± verileri yÃ¼klenirken hata:', error);
            }
        }

        async function loadCommentsData() {
            const commentsContainer = document.getElementById('admin-comments-list');
            commentsContainer.innerHTML = '';

            comments.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.className = `border rounded-lg p-4 ${comment.verified ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`;
                
                const formattedDate = comment.timestamp instanceof Date ? 
                    comment.timestamp.toLocaleDateString('tr-TR') : 
                    new Date(comment.timestamp).toLocaleDateString('tr-TR');

                commentDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <h4 class="font-semibold text-gray-800">${comment.userName}</h4>
                                <span class="ml-2 px-2 py-1 text-xs rounded-full ${comment.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${comment.verified ? 'OnaylandÄ±' : 'Beklemede'}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${comment.icerikAdi} (${comment.icerikTuru}) - ${comment.puan}/10</p>
                            <p class="text-gray-800">${comment.yorum}</p>
                            <p class="text-xs text-gray-500 mt-2">${formattedDate}</p>
                            ${comment.izlendi ? '<span class="inline-block mt-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Ä°zlendi/Okundu</span>' : ''}
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button class="verify-comment-btn px-3 py-1 text-sm ${comment.verified ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded" data-comment-id="${comment.id}" data-verified="${comment.verified}">
                                ${comment.verified ? 'OnayÄ± KaldÄ±r' : 'Onayla'}
                            </button>
                            <button class="delete-comment-btn px-3 py-1 text-sm bg-red-500 hover:bg-red-600 text-white rounded" data-comment-id="${comment.id}">
                                Sil
                            </button>
                        </div>
                    </div>
                `;

                // Add event listeners
                const verifyBtn = commentDiv.querySelector('.verify-comment-btn');
                const deleteBtn = commentDiv.querySelector('.delete-comment-btn');

                verifyBtn.addEventListener('click', async () => {
                    await toggleCommentVerification(comment.id, !comment.verified);
                });

                deleteBtn.addEventListener('click', async () => {
                    if (confirm('Bu yorumu silmek istediÄŸinizden emin misiniz?')) {
                        await deleteComment(comment.id);
                    }
                });

                commentsContainer.appendChild(commentDiv);
            });
        }

        async function loadContentData() {
            const contentContainer = document.getElementById('admin-content-list');
            contentContainer.innerHTML = '';

            contents.forEach(content => {
                const contentDiv = document.createElement('div');
                contentDiv.className = 'border rounded-lg p-4 bg-white';
                
                const imageUrl = content.image && content.image.trim() !== '' ? content.image : 'https://via.placeholder.com/150x200?text=No+Image';

                contentDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <img src="${imageUrl}" alt="${content.name}" class="w-16 h-20 object-cover rounded">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${content.name}</h4>
                            <p class="text-sm text-gray-600">${content.tur === 'film' ? 'Film' : 'Kitap'}</p>
                            ${content.year ? `<p class="text-sm text-gray-600">YÄ±l: ${content.year}</p>` : ''}
                            ${content.author ? `<p class="text-sm text-gray-600">Yazar: ${content.author}</p>` : ''}
                            ${content.tarih_araligi ? `<p class="text-sm text-purple-600">${content.tarih_araligi}</p>` : ''}
                        </div>
                        <button class="delete-content-admin px-3 py-1 text-sm bg-red-500 hover:bg-red-600 text-white rounded" data-content-id="${content.id}">
                            Sil
                        </button>
                    </div>
                `;

                // Add event listener
                const deleteBtn = contentDiv.querySelector('.delete-content-admin');
                deleteBtn.addEventListener('click', async () => {
                    if (confirm('Bu iÃ§eriÄŸi silmek istediÄŸinizden emin misiniz?')) {
                        await deleteContent(content.id);
                        loadContentData(); // Reload content data
                    }
                });

                contentContainer.appendChild(contentDiv);
            });
        }

        async function loadUserProfile() {
            if (!currentUser || isGuest) return;

            try {
                // Load user data from Firebase
                const userDoc = window.firestore.doc(window.db, 'users', currentUser.id);
                const userSnapshot = await window.firestore.getDoc(userDoc);
                
                let userData = currentUser;
                if (userSnapshot && userSnapshot.exists()) {
                    userData = { ...currentUser, ...userSnapshot.data() };
                }

                // Display profile info
                const profileInfo = document.getElementById('profile-info');
                profileInfo.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-medium text-gray-700">Ad Soyad:</span>
                            <span class="text-gray-900">${userData.ad || ''} ${userData.soyad || ''}</span>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700">Email:</span>
                            <span class="text-gray-900">${userData.email}</span>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700">YaÅŸ:</span>
                            <span class="text-gray-900">${userData.yas || 'BelirtilmemiÅŸ'}</span>
                        </div>
                        <div>
                            <span class="font-medium text-gray-700">Cinsiyet:</span>
                            <span class="text-gray-900">${userData.cinsiyet || 'BelirtilmemiÅŸ'}</span>
                        </div>
                    </div>
                `;

                // Display watched content
                const userComments = comments.filter(comment => comment.userId === currentUser.id && comment.izlendi);
                const watchedContent = document.getElementById('watched-content');
                
                if (userComments.length === 0) {
                    watchedContent.innerHTML = '<p class="text-gray-500">HenÃ¼z izlediÄŸiniz/okuduÄŸunuz iÃ§erik bulunmuyor.</p>';
                } else {
                    watchedContent.innerHTML = userComments.map(comment => `
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div>
                                <span class="font-medium text-gray-800">${comment.icerikAdi}</span>
                                <span class="text-sm text-gray-600 ml-2">(${comment.icerikTuru === 'film' ? 'Film' : 'Kitap'})</span>
                            </div>
                            <div class="flex items-center">
                                <svg class="h-4 w-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                                <span class="text-sm text-gray-700">${comment.puan}/10</span>
                            </div>
                        </div>
                    `).join('');
                }

                // Display user comments
                const userAllComments = comments.filter(comment => comment.userId === currentUser.id);
                const myComments = document.getElementById('my-comments');
                
                if (userAllComments.length === 0) {
                    myComments.innerHTML = '<p class="text-gray-500">HenÃ¼z yorum yapmamÄ±ÅŸsÄ±nÄ±z.</p>';
                } else {
                    myComments.innerHTML = userAllComments.map(comment => {
                        const formattedDate = comment.timestamp instanceof Date ? 
                            comment.timestamp.toLocaleDateString('tr-TR') : 
                            new Date(comment.timestamp).toLocaleDateString('tr-TR');

                        return `
                            <div class="border rounded-lg p-4 ${comment.verified ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-medium text-gray-800">${comment.icerikAdi}</h4>
                                        <span class="text-sm text-gray-600">${comment.icerikTuru === 'film' ? 'Film' : 'Kitap'} - ${formattedDate}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="h-4 w-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        <span class="text-sm text-gray-700">${comment.puan}/10</span>
                                        <span class="ml-2 px-2 py-1 text-xs rounded-full ${comment.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                            ${comment.verified ? 'OnaylandÄ±' : 'Beklemede'}
                                        </span>
                                    </div>
                                </div>
                                <p class="text-gray-700">${comment.yorum}</p>
                                ${comment.izlendi ? '<span class="inline-block mt-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Ä°zlendi/Okundu</span>' : ''}
                            </div>
                        `;
                    }).join('');
                }

            } catch (error) {
                console.error('Profil yÃ¼klenirken hata:', error);
            }
        }

        async function makeUserAdmin(userId) {
            try {
                showLoading();
                
                // Get user data first for logging
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', userId));
                const userData = userDoc.data();
                
                await window.firestore.updateDoc(window.firestore.doc(window.db, 'users', userId), {
                    role: 'admin'
                });

                // Create log entry
                await createLog('Admin Yetkisi Verildi', `${userData.ad} ${userData.soyad} kullanÄ±cÄ±sÄ±na admin yetkisi verildi.`);
                
                await loadUsersData(); // Reload users data
                hideLoading();
            } catch (error) {
                hideLoading();
                alert('KullanÄ±cÄ± admin yapÄ±lÄ±rken hata oluÅŸtu: ' + error.message);
            }
        }

        async function deleteUser(userId) {
            try {
                showLoading();
                
                // Get user data first for logging
                const userDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'users', userId));
                const userData = userDoc.data();
                
                await window.firestore.deleteDoc(window.firestore.doc(window.db, 'users', userId));

                // Create log entry
                await createLog('KullanÄ±cÄ± Silindi', `${userData.ad} ${userData.soyad} kullanÄ±cÄ±sÄ± sistemden silindi.`);
                
                await loadUsersData(); // Reload users data
                hideLoading();
            } catch (error) {
                hideLoading();
                alert('KullanÄ±cÄ± silinirken hata oluÅŸtu: ' + error.message);
            }
        }

        function showUserProfile(user) {
            const modal = document.getElementById('user-profile-modal');
            const title = document.getElementById('user-profile-modal-title');
            const content = document.getElementById('user-profile-content');

            title.textContent = `${user.ad} ${user.soyad} - Profil`;

            // Get user's comments and watched content
            const userComments = comments.filter(comment => comment.userId === user.id);
            const watchedContent = userComments.filter(comment => comment.izlendi);

            const profileDate = user.profilOlusturmaTarihi ? 
                (user.profilOlusturmaTarihi.toDate ? user.profilOlusturmaTarihi.toDate() : new Date(user.profilOlusturmaTarihi)) : 
                new Date();

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- KiÅŸisel Bilgiler -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">KiÅŸisel Bilgiler</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="font-medium text-gray-700">Ad Soyad:</span>
                                <span class="text-gray-900 ml-2">${user.ad} ${user.soyad}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">Email:</span>
                                <span class="text-gray-900 ml-2">${user.email}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">YaÅŸ:</span>
                                <span class="text-gray-900 ml-2">${user.yas || 'BelirtilmemiÅŸ'}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">Cinsiyet:</span>
                                <span class="text-gray-900 ml-2">${user.cinsiyet || 'BelirtilmemiÅŸ'}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">KayÄ±t Tarihi:</span>
                                <span class="text-gray-900 ml-2">${profileDate.toLocaleDateString('tr-TR')}</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-700">Rol:</span>
                                <span class="px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'} ml-2">
                                    ${user.role === 'admin' ? 'Admin' : 'KullanÄ±cÄ±'}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Ä°zlenen/Okunan Ä°Ã§erikler -->
                    <div class="bg-green-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Ä°zlenen/Okunan Ä°Ã§erikler (${watchedContent.length})</h3>
                        ${watchedContent.length === 0 ? 
                            '<p class="text-gray-500">HenÃ¼z izlenen/okunan iÃ§erik bulunmuyor.</p>' :
                            watchedContent.map(comment => `
                                <div class="flex items-center justify-between p-3 bg-white rounded-lg mb-2">
                                    <div>
                                        <span class="font-medium text-gray-800">${comment.icerikAdi}</span>
                                        <span class="text-sm text-gray-600 ml-2">(${comment.icerikTuru === 'film' ? 'Film' : 'Kitap'})</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="h-4 w-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                        <span class="text-sm text-gray-700">${comment.puan}/10</span>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>

                    <!-- TÃ¼m Yorumlar -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">TÃ¼m Yorumlar (${userComments.length})</h3>
                        ${userComments.length === 0 ? 
                            '<p class="text-gray-500">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.</p>' :
                            userComments.map(comment => {
                                const formattedDate = comment.timestamp instanceof Date ? 
                                    comment.timestamp.toLocaleDateString('tr-TR') : 
                                    new Date(comment.timestamp).toLocaleDateString('tr-TR');

                                return `
                                    <div class="border rounded-lg p-4 bg-white mb-3 ${comment.verified ? 'border-green-200' : 'border-yellow-200'}">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <h4 class="font-medium text-gray-800">${comment.icerikAdi}</h4>
                                                <span class="text-sm text-gray-600">${comment.icerikTuru === 'film' ? 'Film' : 'Kitap'} - ${formattedDate}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <svg class="h-4 w-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                                </svg>
                                                <span class="text-sm text-gray-700">${comment.puan}/10</span>
                                                <span class="ml-2 px-2 py-1 text-xs rounded-full ${comment.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                                    ${comment.verified ? 'OnaylandÄ±' : 'Beklemede'}
                                                </span>
                                            </div>
                                        </div>
                                        <p class="text-gray-700">${comment.yorum}</p>
                                        ${comment.izlendi ? '<span class="inline-block mt-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Ä°zlendi/Okundu</span>' : ''}
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
            `;

            showModal('user-profile-modal');
        }

        async function loadLogsData() {
            try {
                showLoading();
                
                // Load logs from Firebase with error handling
                let logs = [];
                
                try {
                    const logsSnapshot = await window.firestore.getDocs(
                        window.firestore.query(
                            window.firestore.collection(window.db, 'logs'),
                            window.firestore.orderBy('timestamp', 'desc')
                        )
                    );
                    
                    logsSnapshot.forEach((doc) => {
                        const data = doc.data();
                        // Handle Firestore timestamp conversion
                        if (data.timestamp && data.timestamp.toDate) {
                            data.timestamp = data.timestamp.toDate();
                        } else if (data.timestamp && typeof data.timestamp === 'string') {
                            data.timestamp = new Date(data.timestamp);
                        } else if (!data.timestamp) {
                            data.timestamp = new Date();
                        }
                        logs.push({ id: doc.id, ...data });
                    });
                } catch (firestoreError) {
                    console.error('Firestore logs yÃ¼kleme hatasÄ±:', firestoreError);
                    // If Firestore fails, keep logs empty
                    logs = [];
                }

                const logsContainer = document.getElementById('admin-logs-list');
                logsContainer.innerHTML = '';

                if (logs.length === 0) {
                    logsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">HenÃ¼z log kaydÄ± bulunmuyor.</p>';
                    hideLoading();
                    return;
                }

                logs.forEach(log => {
                    const logDiv = document.createElement('div');
                    const formattedDate = log.timestamp instanceof Date ? 
                        log.timestamp.toLocaleString('tr-TR') : 
                        new Date(log.timestamp).toLocaleString('tr-TR');

                    let logClass = 'border-l-4 ';
                    let iconColor = '';
                    let iconPath = '';
                    
                    switch (log.action) {
                        case 'KullanÄ±cÄ± KaydÄ±':
                            logClass += 'border-green-500 bg-green-50';
                            iconColor = 'text-green-500';
                            iconPath = 'M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z';
                            break;
                        case 'KullanÄ±cÄ± GiriÅŸi':
                            logClass += 'border-green-400 bg-green-50';
                            iconColor = 'text-green-400';
                            iconPath = 'M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1';
                            break;
                        case 'KullanÄ±cÄ± Ã‡Ä±kÄ±ÅŸÄ±':
                            logClass += 'border-gray-500 bg-gray-50';
                            iconColor = 'text-gray-500';
                            iconPath = 'M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1';
                            break;
                        case 'Yorum Eklendi':
                            logClass += 'border-blue-500 bg-blue-50';
                            iconColor = 'text-blue-500';
                            iconPath = 'M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z';
                            break;
                        case 'Yorum OnaylandÄ±':
                        case 'Yorum OnayÄ± KaldÄ±rÄ±ldÄ±':
                            logClass += 'border-purple-500 bg-purple-50';
                            iconColor = 'text-purple-500';
                            iconPath = 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z';
                            break;
                        case 'Yorum Silindi':
                            logClass += 'border-red-400 bg-red-50';
                            iconColor = 'text-red-400';
                            iconPath = 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16';
                            break;
                        case 'Ä°Ã§erik Eklendi':
                            logClass += 'border-teal-500 bg-teal-50';
                            iconColor = 'text-teal-500';
                            iconPath = 'M12 4v16m8-8H4';
                            break;
                        case 'Ä°Ã§erik Silindi':
                            logClass += 'border-red-600 bg-red-50';
                            iconColor = 'text-red-600';
                            iconPath = 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16';
                            break;
                        case 'Admin Yetkisi Verildi':
                            logClass += 'border-orange-500 bg-orange-50';
                            iconColor = 'text-orange-500';
                            iconPath = 'M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z';
                            break;
                        case 'KullanÄ±cÄ± Silindi':
                            logClass += 'border-red-500 bg-red-50';
                            iconColor = 'text-red-500';
                            iconPath = 'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16';
                            break;
                        case 'Sistem BaÅŸlatÄ±ldÄ±':
                            logClass += 'border-indigo-500 bg-indigo-50';
                            iconColor = 'text-indigo-500';
                            iconPath = 'M13 10V3L4 14h7v7l9-11h-7z';
                            break;
                        default:
                            logClass += 'border-gray-500 bg-gray-50';
                            iconColor = 'text-gray-500';
                            iconPath = 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z';
                    }

                    logDiv.className = `${logClass} rounded-lg p-4 mb-3`;
                    
                    logDiv.innerHTML = `
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <svg class="w-6 h-6 ${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPath}"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="text-sm font-semibold text-gray-800">${log.action}</h4>
                                    <span class="text-xs text-gray-500">${formattedDate}</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${log.details}</p>
                                <p class="text-xs text-gray-500 mt-2">ðŸ‘¤ ${log.userName}</p>
                            </div>
                        </div>
                    `;

                    logsContainer.appendChild(logDiv);
                });

                hideLoading();
            } catch (error) {
                hideLoading();
                console.error('Log verileri yÃ¼klenirken hata:', error);
                const logsContainer = document.getElementById('admin-logs-list');
                logsContainer.innerHTML = `
                    <div class="text-center py-8">
                        <p class="text-red-500 mb-4">Log verileri yÃ¼klenirken hata oluÅŸtu.</p>
                        <p class="text-gray-500 text-sm">Hata: ${error.message}</p>
                        <button onclick="loadLogsData()" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                            Tekrar Dene
                        </button>
                    </div>
                `;
            }
        }

        async function toggleCommentVerification(commentId, isVerified) {
            try {
                showLoading();
                await window.firestore.updateDoc(window.firestore.doc(window.db, 'yorumlar', commentId), {
                    verified: isVerified
                });

                // Create log entry
                const comment = comments.find(c => c.id === commentId);
                if (comment) {
                    await createLog('Yorum OnaylandÄ±', `"${comment.icerikAdi}" iÃ§in ${comment.userName} kullanÄ±cÄ±sÄ±nÄ±n yorumu ${isVerified ? 'onaylandÄ±' : 'onayÄ± kaldÄ±rÄ±ldÄ±'}.`);
                }

                await loadData(); // Reload all data
                loadCommentsData(); // Reload comments in admin panel
                hideLoading();
            } catch (error) {
                hideLoading();
                alert('Yorum durumu gÃ¼ncellenirken hata oluÅŸtu: ' + error.message);
            }
        }

        async function deleteComment(commentId) {
            try {
                showLoading();
                
                // Get comment data first for logging
                const commentDoc = await window.firestore.getDoc(window.firestore.doc(window.db, 'yorumlar', commentId));
                const commentData = commentDoc.data();
                
                await window.firestore.deleteDoc(window.firestore.doc(window.db, 'yorumlar', commentId));
                
                // Create log entry for comment deletion
                if (commentData) {
                    await createLog('Yorum Silindi', `${currentUser.name} tarafÄ±ndan ${commentData.userName} kullanÄ±cÄ±sÄ±nÄ±n "${commentData.icerikAdi}" iÃ§in yaptÄ±ÄŸÄ± yorum silindi.`);
                }
                
                await loadData(); // Reload all data
                loadCommentsData(); // Reload comments in admin panel
                hideLoading();
            } catch (error) {
                hideLoading();
                alert('Yorum silinirken hata oluÅŸtu: ' + error.message);
            }
        }

        function getFirebaseErrorMessage(errorCode) {
            const errorMessages = {
                'auth/user-not-found': 'KullanÄ±cÄ± bulunamadÄ±.',
                'auth/wrong-password': 'HatalÄ± ÅŸifre.',
                'auth/email-already-in-use': 'Bu email adresi zaten kullanÄ±mda.',
                'auth/weak-password': 'Åžifre Ã§ok zayÄ±f.',
                'auth/invalid-email': 'GeÃ§ersiz email adresi.',
                'auth/too-many-requests': 'Ã‡ok fazla deneme yapÄ±ldÄ±. LÃ¼tfen daha sonra tekrar deneyin.',
                'auth/network-request-failed': 'AÄŸ baÄŸlantÄ±sÄ± hatasÄ±.'
            };
            
            return errorMessages[errorCode] || 'Bir hata oluÅŸtu: ' + errorCode;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96cf472575c7e333',t:'MTc1NDgyNjY1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
